/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// app/main.ts
var main_exports = {};
__export(main_exports, {
  default: () => MocPlugin
});
module.exports = __toCommonJS(main_exports);
var import_obsidian5 = require("obsidian");

// app/file-manager-utils.ts
var import_obsidian2 = require("obsidian");

// app/moc-management.ts
var import_obsidian = require("obsidian");

// app/constants.ts
var DEBOUNCE_TIMEOUTS = {
  MOC_LINKS_AUTO_UPDATE: 15e3,
  // 15 segundos
  UPDATE_INDEX_MOC_TREE: 100,
  // 100ms
  FILE_AUTO_RENAMING: 50,
  // 50ms
  SESSION_TIMEOUT: 500,
  // 500ms para sessões de rename
  CACHE_REFRESH_DELAY: 200
  // 200ms para aguardar atualização do cache do Obsidian
};
var FILE_PATTERNS = {
  MOC_SPAN_START: '<span class="moc-plugin-start">',
  MOC_SPAN_END: '<span class="moc-plugin-end"> </span>',
  MOC_REGEX: /<span class="moc-plugin-start">([\s\S]*?)<\/span>([\s\S]*?)<span class="moc-plugin-end">/
};
var DEFAULT_CONFIG = {
  LINE_BREAKS_DEFAULT: 10
};

// app/moc-management.ts
var MocAdministrator = class {
  constructor(pluginInjector, self_file) {
    this.app = pluginInjector.app;
    this.plugin = pluginInjector;
    this.self_file = self_file;
    this.settings = pluginInjector.settings;
    this.fileManager = new FileManagerUtils(pluginInjector);
  }
  connect() {
    this.MocLinks = this.generateMocConnections();
  }
  async deleteMocString(resetLines = true) {
    let mocRegex;
    if (resetLines) {
      mocRegex = /((?:^[ \t]*\r?\n)*)^---[\s\r\n]*<span class="moc-plugin-start">MOC Links:<\/span>[\s\S]*?<span class="moc-plugin-end">\s*<\/span>[\s\r\n]*---[\s\r\n]*((?:^[ \t]*\r?\n)*)$/gm;
    } else {
      mocRegex = /^---[\s\r\n]*<span class="moc-plugin-start">MOC Links:<\/span>[\s\S]*?<span class="moc-plugin-end">\s*<\/span>[\s\r\n]*---[\s\r\n]*/gm;
    }
    try {
      this.app.vault.process(this.self_file, (content) => {
        return content.replace(mocRegex, "");
      }).catch((err) => {
        console.error("Error deleting MOC string:", err);
      });
    } catch (err) {
      console.log(err);
    }
  }
  generateMocConnections() {
    const mocLinks = {
      parent: this.getParentLink(),
      children: this.getChildrenLinks(),
      files: this.getFilesLinks()
    };
    return mocLinks;
  }
  async updateMocLinks() {
    await this.deleteMocString(false);
    await this.mocInjectorToFile(0);
  }
  async mocLinksAutoUpdate() {
    if (this.fileManager.isIndexFile(this.self_file)) {
      const fileExists = await this.app.vault.adapter.exists(this.self_file.path);
      if (!fileExists) {
        console.warn(`File ${this.self_file.path} no longer exists, skipping MOC update`);
        return;
      }
      try {
        const mocAdministrator = new MocAdministrator(this.plugin, this.self_file);
        mocAdministrator.connect();
        await mocAdministrator.updateMocLinks();
      } catch (error) {
        console.error(`Error updating MOC for ${this.self_file.path}:`, error);
      }
    }
  }
  async updateIndexMocTree() {
    const files = this.app.vault.getMarkdownFiles().filter((file) => this.fileManager.isIndexFile(file));
    for (const file of files) {
      const fileExists = await this.app.vault.adapter.exists(file.path);
      if (fileExists) {
        const mocAdministrator = new MocAdministrator(this.plugin, file);
        mocAdministrator.connect();
        await mocAdministrator.updateMocLinks();
      } else {
        console.warn(`File ${file.path} no longer exists, skipping in updateIndexMocTree`);
      }
    }
  }
  //Updates Files inside the ObjectAdministrator
  getFilesLinks(self_file = this.self_file) {
    let filesArr = void 0;
    if (!self_file.parent) {
      filesArr = this.app.vault.getRoot().children.filter((absFile) => absFile instanceof import_obsidian.TFile && absFile.path !== self_file.path);
    } else {
      filesArr = self_file.parent.children.filter((absFile) => absFile instanceof import_obsidian.TFile && absFile.path !== self_file.path);
    }
    if (!filesArr || filesArr.length === 0) {
      return null;
    }
    return filesArr;
  }
  getParentLink(self_file = this.self_file) {
    let parentFolder = self_file.parent;
    if (!parentFolder) {
      return null;
    }
    parentFolder = parentFolder.parent;
    while (parentFolder) {
      const indexFilesChildren = parentFolder.children.filter((child) => {
        var _a;
        if (child instanceof import_obsidian.TFile) {
          const frontmatterCopy = (_a = this.app.metadataCache.getFileCache(child)) == null ? void 0 : _a.frontmatter;
          if (frontmatterCopy && frontmatterCopy[this.settings.mocPropertyKey] === this.settings.mocPropertyValue) {
            return true;
          }
        }
      });
      if (indexFilesChildren.length === 1) {
        return indexFilesChildren[0];
      } else if (indexFilesChildren.length > 1) {
        return indexFilesChildren[0];
      }
      parentFolder = parentFolder.parent;
    }
    return null;
  }
  getChildrenLinks(self_file = this.self_file) {
    const parentFolder = this.fileManager.getDirectParent(self_file);
    let childrenLinks = [];
    const recursiveChildrenFinder = (startingFolder) => {
      let directChildrenFolders = [];
      let directChildrenFiles = [];
      startingFolder.children.forEach((child) => {
        var _a;
        if (child instanceof import_obsidian.TFile) {
          const frontmatterCopy = (_a = this.app.metadataCache.getFileCache(child)) == null ? void 0 : _a.frontmatter;
          if (frontmatterCopy && frontmatterCopy[this.settings.mocPropertyKey] === this.settings.mocPropertyValue) {
            directChildrenFiles.push(child);
          }
        } else if (child instanceof import_obsidian.TFolder) {
          directChildrenFolders.push(child);
        }
      });
      if (directChildrenFiles.length === 0) {
        directChildrenFolders.forEach((folder) => {
          recursiveChildrenFinder(folder);
        });
      }
      if (directChildrenFiles.length > 1) {
      }
      childrenLinks = [...childrenLinks, ...directChildrenFiles];
    };
    parentFolder.children.forEach((child) => {
      if (child instanceof import_obsidian.TFolder) {
        recursiveChildrenFinder(child);
      }
    });
    if (childrenLinks.length === 0) {
      return null;
    }
    return childrenLinks;
  }
  mocStringGenerator() {
    const header = this.settings.mocHeader;
    const { parent, children, files } = this.MocLinks;
    const parentLinkString = parent ? `${this.app.fileManager.generateMarkdownLink(parent, this.self_file.path)}` : "*None*";
    const childrenLinksString = children && children.length > 0 ? children.map((child) => `- ${this.app.fileManager.generateMarkdownLink(child, this.self_file.path)}`).join("\n") : "- *None*";
    const filesLinksString = files && files.length > 0 ? files.map((file) => `- ${this.app.fileManager.generateMarkdownLink(file, this.self_file.path)}`).join("\n") : "- *None*";
    const mocString = `---
${FILE_PATTERNS.MOC_SPAN_START}${header}</span>
#### Parent:
- ${parentLinkString}
#### Children:
${childrenLinksString}
#### Files:
${filesLinksString}
${FILE_PATTERNS.MOC_SPAN_END}
---`;
    return mocString;
  }
  async mocInjectorToFile(lineBreaks = DEFAULT_CONFIG.LINE_BREAKS_DEFAULT) {
    try {
      const moc = this.mocStringGenerator();
      const returnValue = this.app.vault.process(this.self_file, (content) => {
        const endsWithNewline = content.endsWith("\n");
        const newContent = (endsWithNewline ? content : `${content}
`) + `${"\n".repeat(lineBreaks)}` + moc;
        return newContent;
      }).catch((err) => {
        console.error("Error inserting MOC links:", err);
      });
    } catch (error) {
      new import_obsidian.Notice(`Error inserting MOC links: ${error.message}, Check if the Moc Administrator is Connected to the file.`);
    }
  }
};

// app/file-manager-utils.ts
var FileManagerUtils = class {
  constructor(plugininjector) {
    this.app = plugininjector.app;
    this.plugin = plugininjector;
  }
  async createIndexFile(filePathWithName, content, propertyName, propertyValue, templatePathOverwritten) {
    let templatePath = templatePathOverwritten || this.plugin.settings.templatePath;
    if (templatePath) {
      try {
        const templateFile = this.app.vault.getFileByPath(templatePath);
        if (templateFile) {
          content = await this.app.vault.read(templateFile);
          console.log(content);
        } else {
          new import_obsidian2.Notice(`Template file not found: ${templatePath}`);
        }
      } catch (error) {
        new import_obsidian2.Notice(`Error reading template file: ${error.message}`);
      }
    }
    try {
      const file = await this.app.vault.create(filePathWithName, content);
      new import_obsidian2.Notice(`MOC file created: ${filePathWithName}`);
      await this.app.fileManager.processFrontMatter(file, (frontmatter) => {
        frontmatter[propertyName] = propertyValue;
      });
      const mocAdministrator = new MocAdministrator(this.plugin, file);
      mocAdministrator.connect();
      await mocAdministrator.mocInjectorToFile();
      return file;
    } catch (error) {
      new import_obsidian2.Notice(`Error creating MOC file: ${error.message}`);
      return;
    }
  }
  createIndexFileNameAndPath(folder) {
    folder = folder || this.app.vault.getRoot();
    let folderNameCopy = folder == null ? void 0 : folder.name.replace(/\p{Emoji_Presentation}/gu, "");
    if (folder.isRoot()) {
      folderNameCopy = folder.vault.getName();
    }
    return `${folder.isRoot() ? "" : folder.path + "/"}${this.plugin.settings.indexFilePrefix}${this.plugin.settings.autoRenameIndexFile ? folderNameCopy.trim() : ""}${this.plugin.settings.indexFileSuffix}.md`;
  }
  async fileAutoRenaming(file, trackRename) {
    if (!this.isIndexFile(file)) {
      return;
    }
    const fileExists = await this.app.vault.adapter.exists(file.path);
    if (!fileExists) {
      return;
    }
    const parentFolder = this.getDirectParent(file);
    const newFileName = this.createIndexFileNameAndPath(parentFolder);
    if (newFileName !== file.path) {
      try {
        if (trackRename) {
          trackRename(file.path);
        }
        await this.app.fileManager.renameFile(file, newFileName);
        const newFileNameOnly = newFileName.split("/").pop() || "";
        if (newFileNameOnly !== "") {
          new import_obsidian2.Notice(`Index file renamed to: ${newFileNameOnly}`);
        }
      } catch (error) {
        console.error("Error renaming index file:", error);
      }
    }
  }
  async readFileMetadata(file) {
    return this.app.metadataCache.getFileCache(file);
  }
  filterFilesByProperty(propertyName, propertyValue) {
    var _a;
    const files = this.app.vault.getMarkdownFiles();
    const filteredFiles = [];
    for (const file of files) {
      const metadata = this.app.metadataCache.getFileCache(file);
      if (metadata && metadata.frontmatter) {
        if (metadata.frontmatter[propertyName] === propertyValue || ((_a = metadata.frontmatter[propertyName]) == null ? void 0 : _a.includes(propertyValue))) {
          filteredFiles.push(file);
        }
      }
    }
    return filteredFiles;
  }
  async folderAutoRenaming(absFile, trackRename) {
    var _a;
    if (absFile instanceof import_obsidian2.TFolder) {
      const folder = absFile;
      const folderName = this.insertEmojiInFolderName(folder.name);
      if (folderName !== folder.name) {
        const newPath = `${((_a = folder.parent) == null ? void 0 : _a.path) ? folder.parent.path + "/" : ""}${folderName}`;
        if (trackRename) {
          trackRename(folder.path);
        }
        await this.app.fileManager.renameFile(folder, newPath);
        new import_obsidian2.Notice(`Folder renamed to: ${folderName}`);
      }
    }
  }
  getDirectParent(AbsFile) {
    let parent = AbsFile.parent;
    if (!parent) {
      return this.app.vault.getRoot();
    } else {
      return parent;
    }
  }
  isIndexFile(absFile) {
    if (absFile instanceof import_obsidian2.TFile) {
      const metadata = this.app.metadataCache.getFileCache(absFile);
      const propertyName = this.plugin.settings.mocPropertyKey;
      const propertyValue = this.plugin.settings.mocPropertyValue;
      if (metadata && metadata.frontmatter) {
        return metadata.frontmatter[propertyName] === propertyValue && Object.keys(metadata.frontmatter).includes(propertyName);
      }
    }
    return false;
  }
  insertEmojiInFolderName(folderName) {
    const emoji = this.plugin.settings.autoFolderEmoji;
    if (folderName.startsWith(emoji)) {
      return folderName;
    }
    folderName = folderName.replace(/\p{Emoji_Presentation}/gu, "");
    return emoji ? `${emoji}${folderName}` : folderName;
  }
  /**
   * Obtém o caminho da pasta base para a sessão de rename
   */
  getBaseFolderPath(absFile, oldPath) {
    if (absFile instanceof import_obsidian2.TFolder) {
      return oldPath;
    }
    return oldPath.substring(0, oldPath.lastIndexOf("/"));
  }
  /**
   * Determina se a pasta renomeada é a pasta raiz sendo renomeada pelo usuário,
   * não uma pasta filha afetada por um rename de pasta pai
   */
  isRootRenamedFolder(renamedFolder, oldPath) {
    const oldParentPath = oldPath.substring(0, oldPath.lastIndexOf("/"));
    const newParentPath = renamedFolder.path.substring(0, renamedFolder.path.lastIndexOf("/"));
    return oldParentPath === newParentPath;
  }
  /**
   * Normaliza um caminho removendo barras no início e fim
   */
  normalizePath(path) {
    return path.replace(/^\/+|\/+$/g, "");
  }
  /**
   * Verifica se um caminho é filho de uma pasta base
   */
  isChildOfPath(childPath, basePath) {
    const normalizedBase = this.normalizePath(basePath);
    const normalizedChild = this.normalizePath(childPath);
    return normalizedChild === normalizedBase || normalizedChild.startsWith(normalizedBase + "/");
  }
};

// app/settings.ts
var import_obsidian3 = require("obsidian");
var DEFAULT_SETTINGS = class {
  constructor() {
    this.mocPropertyKey = "moc-property";
    this.mocPropertyValue = "defaultValue";
    this.templatePath = void 0;
    this.pathExceptions = [];
    this.mocHeader = "MOC Links:";
    this.autoRenameIndexFile = false;
    this.indexFilePrefix = "Index - ";
    this.indexFileSuffix = "";
    this.autoFolderEmoji = "";
  }
};
var SettingsTab = class extends import_obsidian3.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  display() {
    const { containerEl } = this;
    containerEl.empty();
    new import_obsidian3.Setting(containerEl).setName("Moc Property Key").setDesc("Set your desired property key to be used in MOC files").addText(
      (text) => text.setPlaceholder("Moc property key").setValue(this.plugin.settings.mocPropertyKey).onChange(async (value) => {
        this.plugin.settings.mocPropertyKey = value;
        await this.plugin.saveSettings();
      })
    );
    new import_obsidian3.Setting(containerEl).setName("Moc Property Value").setDesc("Set your desired property value (to be found inside your property key) to be used in MOC files").addText(
      (text) => text.setPlaceholder("Moc property value").setValue(this.plugin.settings.mocPropertyValue).onChange(async (value) => {
        this.plugin.settings.mocPropertyValue = value;
        await this.plugin.saveSettings();
      })
    );
    new import_obsidian3.Setting(containerEl).setName("Template Path").setDesc("Set the path to your template file (optional)").addText((text) => {
      text.setPlaceholder("Template path").onChange(async (value) => {
        this.plugin.settings.templatePath = value;
        await this.plugin.saveSettings();
      });
      if (this.plugin.settings.templatePath) {
        text.setValue(this.plugin.settings.templatePath);
      }
    });
    containerEl.createDiv({ text: "Ex: path/to/your/template.md", cls: ["setting-item-description", "space-separator"] });
    new import_obsidian3.Setting(containerEl).setName("Path Exceptions").setDesc("Set paths to be ignored by the plugin (separated by line breaks)").addTextArea((textArea) => {
      textArea.setPlaceholder("Path exceptions").setValue(this.plugin.settings.pathExceptions.join("\n")).onChange(async (value) => {
        this.plugin.settings.pathExceptions = value.split("\n").map((item) => item.trim());
        await this.plugin.saveSettings();
      });
    });
    new import_obsidian3.Setting(containerEl).setName("Index File Prefix").setDesc("Set the prefix for the index file name.").addText(
      (text) => text.setPlaceholder("Index File Prefix").setValue(this.plugin.settings.indexFilePrefix).onChange(async (value) => {
        this.plugin.settings.indexFilePrefix = value;
        await this.plugin.saveSettings();
      })
    );
    new import_obsidian3.Setting(containerEl).setName("Index File Suffix").setDesc("Set the suffix for the index file name.").addText(
      (text) => text.setPlaceholder("Index File Suffix").setValue(this.plugin.settings.indexFileSuffix).onChange(async (value) => {
        this.plugin.settings.indexFileSuffix = value;
        await this.plugin.saveSettings();
      })
    );
    new import_obsidian3.Setting(containerEl).setName("Auto-Emoji Folders").setDesc("Automatically add specified emoji to folder names' prefixes when created.").addText(
      (text) => text.setPlaceholder("Enter emoji").setValue(this.plugin.settings.autoFolderEmoji).onChange(async (value) => {
        this.plugin.settings.autoFolderEmoji = value;
        await this.plugin.saveSettings();
      })
    );
    new import_obsidian3.Setting(containerEl).setName("Index File Auto-Rename from Folder Name Radical").setDesc("Automatically rename the index file to match the folder name when creating a new MOC file.").addToggle(
      (toggle) => toggle.setValue(this.plugin.settings.autoRenameIndexFile).onChange(async (value) => {
        this.plugin.settings.autoRenameIndexFile = value;
        await this.plugin.saveSettings();
      })
    );
    new import_obsidian3.Setting(containerEl).setName("Update File Tree").setDesc("Automatically update the File Moc tree and defined settings on click.").addButton((button) => button.setButtonText("Update").onClick(async () => {
      const anyFile = this.app.vault.getFiles().find((file) => file instanceof import_obsidian3.TFile);
      const mocAdmin = new MocAdministrator(this.plugin, anyFile);
      const allFolders = this.app.vault.getAllFolders().filter((file) => file instanceof import_obsidian3.TFolder);
      for (const folder of allFolders) {
        await this.plugin.FileManagerUtils.folderAutoRenaming(folder);
      }
      console.log(allFolders);
      mocAdmin.updateIndexMocTree();
    }));
  }
};

// app/event-handlers.ts
var import_obsidian4 = require("obsidian");
var EventHandlers = class {
  constructor(plugin) {
    this.pluginInitiatedRenames = /* @__PURE__ */ new Set();
    // Session tracking para distinguir user-initiated renames de cascading rename events
    // Quando o usuário renomeia uma pasta, Obsidian dispara eventos para todas as subpastas e arquivos
    // Este sistema rastreia a sessão para ignorar eventos cascateados e processar apenas o rename inicial
    this.userRenameSession = { processed: /* @__PURE__ */ new Set() };
    this.app = plugin.app;
    this.plugin = plugin;
    this.fileManagerUtils = new FileManagerUtils(plugin);
  }
  async loadEventHandlers() {
    const mocLinksAutoUpdateDebouncer = (0, import_obsidian4.debounce)(async (absFile) => {
      const mocAdministrator = new MocAdministrator(this.plugin, absFile);
      mocAdministrator.connect();
      await mocAdministrator.mocLinksAutoUpdate();
      mocLinksAutoUpdateDebouncer.cancel();
    }, DEBOUNCE_TIMEOUTS.MOC_LINKS_AUTO_UPDATE, true);
    const updateIndexMocTreeDebouncer = (0, import_obsidian4.debounce)(async (absFile) => {
      const mocAdministrator = new MocAdministrator(this.plugin, absFile);
      mocAdministrator.connect();
      await mocAdministrator.updateIndexMocTree();
    }, DEBOUNCE_TIMEOUTS.UPDATE_INDEX_MOC_TREE, true);
    const fileAutoRenamingDebouncer = (0, import_obsidian4.debounce)(async (absFile) => {
      await this.fileManagerUtils.fileAutoRenaming(absFile);
      fileAutoRenamingDebouncer.cancel();
    }, DEBOUNCE_TIMEOUTS.FILE_AUTO_RENAMING, true);
    let promiseStack = Promise.resolve();
    this.plugin.registerEvent(this.app.vault.on("create", (absFile) => {
      if (this.plugin.settings.pathExceptions.some((path) => absFile.path.includes(path))) {
        return;
      }
      if (absFile instanceof import_obsidian4.TFolder) {
        const fileNameAndPath = this.fileManagerUtils.createIndexFileNameAndPath(absFile);
        this.fileManagerUtils.createIndexFile(fileNameAndPath, "", this.plugin.settings.mocPropertyKey, this.plugin.settings.mocPropertyValue, this.plugin.settings.templatePath);
      }
    }));
    this.plugin.registerEvent(this.app.vault.on("rename", async (absFile, oldPath) => {
      var _a;
      if (this.plugin.settings.pathExceptions.some((path) => absFile.path.includes(path))) {
        return;
      }
      if (this.pluginInitiatedRenames.has(oldPath)) {
        if (absFile instanceof import_obsidian4.TFolder) {
          const normalizedOldPath = oldPath.replace(/^\/+|\/+$/g, "");
          const normalizedBasePath = (_a = this.userRenameSession.baseFolder) == null ? void 0 : _a.replace(/^\/+|\/+$/g, "");
          if (normalizedOldPath === normalizedBasePath || this.userRenameSession.processed.has(oldPath) || this.userRenameSession.processed.has(normalizedOldPath)) {
            this.userRenameSession.pluginRenamedFolder = absFile.path;
            this.resetSessionTimer();
          }
        }
        if (absFile instanceof import_obsidian4.TFile && this.fileManagerUtils.isIndexFile(absFile)) {
          promiseStack = promiseStack.then(async () => {
            await this.fileManagerUtils.fileAutoRenaming(absFile, (oldPath2) => {
              this.pluginInitiatedRenames.add(oldPath2);
            });
          });
        }
        this.pluginInitiatedRenames.delete(oldPath);
        return;
      }
      const isNewRenameSession = this.detectNewRenameSession(absFile, oldPath);
      if (isNewRenameSession) {
        this.startNewRenameSession(absFile, oldPath);
      } else if (this.isPartOfCurrentRenameSession(absFile, oldPath)) {
        return;
      }
      this.userRenameSession.processed.add(oldPath);
      if (absFile.path !== oldPath) {
        this.userRenameSession.processed.add(absFile.path);
      }
      this.resetSessionTimer();
      promiseStack = promiseStack.then(async () => {
        updateIndexMocTreeDebouncer(absFile);
      });
      try {
        if (absFile.name === oldPath.split("/").pop()) {
          if (absFile instanceof import_obsidian4.TFile && this.fileManagerUtils.isIndexFile(absFile)) {
            promiseStack = promiseStack.then(async () => {
              await this.fileManagerUtils.fileAutoRenaming(absFile, (oldPath2) => {
                this.pluginInitiatedRenames.add(oldPath2);
              });
            });
          }
        } else {
          if (this.plugin.settings.autoFolderEmoji !== "" && absFile instanceof import_obsidian4.TFolder) {
            promiseStack = promiseStack.then(async () => {
              await this.fileManagerUtils.folderAutoRenaming(absFile, (oldPath2) => {
                this.pluginInitiatedRenames.add(oldPath2);
              });
              await new Promise((resolve) => setTimeout(resolve, DEBOUNCE_TIMEOUTS.CACHE_REFRESH_DELAY));
              const filesInFolder = this.app.vault.getMarkdownFiles().filter(
                (file) => file.path.startsWith(absFile.path + "/")
              );
              const indexFiles = filesInFolder.filter(
                (file) => this.fileManagerUtils.isIndexFile(file)
              );
              for (const indexFile of indexFiles) {
                await this.fileManagerUtils.fileAutoRenaming(indexFile, (oldPath2) => {
                  this.pluginInitiatedRenames.add(oldPath2);
                });
              }
            });
          } else if (absFile instanceof import_obsidian4.TFile && this.fileManagerUtils.isIndexFile(absFile)) {
            promiseStack = promiseStack.then(async () => {
              await this.fileManagerUtils.fileAutoRenaming(absFile, (oldPath2) => {
                this.pluginInitiatedRenames.add(oldPath2);
              });
            });
          }
        }
      } catch (error) {
        console.error(`Error handling rename from ${oldPath} to ${absFile.path}:`, error);
      }
    }));
    this.plugin.registerEvent(this.app.vault.on("modify", (absFile) => {
      if (this.plugin.settings.pathExceptions.some((path) => absFile.path.includes(path))) {
        return;
      }
      mocLinksAutoUpdateDebouncer(absFile);
      updateIndexMocTreeDebouncer(absFile);
    }));
    this.plugin.registerEvent(this.app.vault.on("delete", async (absFile) => {
      if (this.plugin.settings.pathExceptions.some((path) => absFile.path.includes(path))) {
        return;
      }
      updateIndexMocTreeDebouncer(absFile);
    }));
  }
  /**
   * Inicia uma nova sessão de rename com timer debounced
   * Isso rastreia o rename inicial iniciado pelo usuário para distingui-lo de eventos cascateados
   */
  startNewRenameSession(absFile, oldPath) {
    if (this.userRenameSession.resetTimer) {
      clearTimeout(this.userRenameSession.resetTimer);
    }
    this.userRenameSession.baseFolder = this.fileManagerUtils.getBaseFolderPath(absFile, oldPath);
    this.userRenameSession.timestamp = Date.now();
    this.userRenameSession.processed.clear();
    this.resetSessionTimer();
  }
  /**
   * Reseta o timer da sessão (debounced)
   * Estende a sessão quando novos eventos de rename são detectados como parte da mesma operação
   */
  resetSessionTimer() {
    if (this.userRenameSession.resetTimer) {
      clearTimeout(this.userRenameSession.resetTimer);
    }
    this.userRenameSession.resetTimer = setTimeout(() => {
      this.clearRenameSession();
    }, DEBOUNCE_TIMEOUTS.SESSION_TIMEOUT);
  }
  /**
   * Clears the current rename session
   */
  clearRenameSession() {
    if (this.userRenameSession.resetTimer) {
      clearTimeout(this.userRenameSession.resetTimer);
    }
    this.userRenameSession.baseFolder = void 0;
    this.userRenameSession.pluginRenamedFolder = void 0;
    this.userRenameSession.timestamp = void 0;
    this.userRenameSession.processed.clear();
    this.userRenameSession.resetTimer = void 0;
  }
  /**
   * Detecta se este é o início de uma nova sessão de rename do usuário
   * Retorna true para renames genuínos iniciados pelo usuário, false para eventos cascateados
   */
  detectNewRenameSession(absFile, oldPath) {
    if (!this.userRenameSession.timestamp || !this.userRenameSession.baseFolder) {
      return true;
    }
    const wasProcessed = this.userRenameSession.processed.has(oldPath);
    const isChild = this.isChildOfBaseFolder(oldPath);
    return !wasProcessed && !isChild;
  }
  /**
   * Checks if this rename is part of the current rename session (cascading effect)
   */
  isPartOfCurrentRenameSession(absFile, oldPath) {
    if (!this.userRenameSession.timestamp || !this.userRenameSession.baseFolder) {
      return false;
    }
    return this.isChildOfBaseFolder(oldPath);
  }
  /**
   * Verifica se um caminho é filho da pasta base atual sendo renomeada
   * Isso inclui verificar contra:
   * - Caminho da pasta base original
   * - Caminho da pasta plugin-renamed (após emoji prefix ser adicionado)
   * - Quaisquer caminhos intermediários processados durante a cadeia de rename
   */
  isChildOfBaseFolder(path) {
    if (!this.userRenameSession.baseFolder) {
      return false;
    }
    if (this.fileManagerUtils.isChildOfPath(path, this.userRenameSession.baseFolder)) {
      return true;
    }
    if (this.userRenameSession.pluginRenamedFolder) {
      if (this.fileManagerUtils.isChildOfPath(path, this.userRenameSession.pluginRenamedFolder)) {
        return true;
      }
    }
    for (const processedPath of this.userRenameSession.processed) {
      if (this.fileManagerUtils.isChildOfPath(path, processedPath)) {
        return true;
      }
    }
    return false;
  }
};

// app/main.ts
var MocPlugin = class extends import_obsidian5.Plugin {
  async onload() {
    await this.loadSettings();
    this.FileManagerUtils = new FileManagerUtils(this);
    this.EventHandlers = new EventHandlers(this);
    this.EventHandlers.loadEventHandlers();
    this.addCommand({
      id: "update-moc-string",
      name: "Update Moc-String on Command",
      callback: async () => {
        const activeFile = this.app.workspace.getActiveFile();
        if (activeFile) {
          const mocAdministrator = new MocAdministrator(this, activeFile);
          await mocAdministrator.updateMocLinks();
          new import_obsidian5.Notice(`MOC Links updated for ${activeFile.name}`);
        }
      }
    });
  }
  onunload() {
  }
  async loadSettings() {
    this.settings = Object.assign(
      {},
      new DEFAULT_SETTINGS(),
      await this.loadData()
    );
    this.addSettingTab(new SettingsTab(this.app, this));
  }
  async saveSettings() {
    await this.saveData(this.settings);
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiYXBwL21haW4udHMiLCAiYXBwL2ZpbGUtbWFuYWdlci11dGlscy50cyIsICJhcHAvbW9jLW1hbmFnZW1lbnQudHMiLCAiYXBwL2NvbnN0YW50cy50cyIsICJhcHAvc2V0dGluZ3MudHMiLCAiYXBwL2V2ZW50LWhhbmRsZXJzLnRzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWyJpbXBvcnQge1xyXG4gICAgTm90aWNlLFxyXG4gICAgUGx1Z2luLFxyXG4gICAgVEZpbGUsXHJcbn0gZnJvbSBcIm9ic2lkaWFuXCI7XHJcblxyXG5pbXBvcnQgeyBGaWxlTWFuYWdlclV0aWxzIH0gZnJvbSBcIi4vZmlsZS1tYW5hZ2VyLXV0aWxzXCI7XHJcbmltcG9ydCB7IFNldHRpbmdzVGFiIH0gZnJvbSBcIi4vc2V0dGluZ3NcIjtcclxuaW1wb3J0IERFRkFVTFRfU0VUVElOR1MgZnJvbSBcIi4vc2V0dGluZ3NcIjtcclxuaW1wb3J0IE1vY0FkbWluaXN0cmF0b3IgZnJvbSBcIi4vbW9jLW1hbmFnZW1lbnRcIjtcclxuaW1wb3J0IEV2ZW50SGFuZGxlcnMgZnJvbSAnLi9ldmVudC1oYW5kbGVycyc7XHJcblxyXG5cclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIE1vY1BsdWdpbiBleHRlbmRzIFBsdWdpbiB7XHJcbiAgICBzZXR0aW5nczogSW5zdGFuY2VUeXBlPHR5cGVvZiBERUZBVUxUX1NFVFRJTkdTPjtcclxuICAgIEZpbGVNYW5hZ2VyVXRpbHM6IEZpbGVNYW5hZ2VyVXRpbHM7XHJcbiAgICBFdmVudEhhbmRsZXJzOiBFdmVudEhhbmRsZXJzO1xyXG5cclxuICAgIGFzeW5jIG9ubG9hZCgpIHtcclxuICAgICAgICBhd2FpdCB0aGlzLmxvYWRTZXR0aW5ncygpO1xyXG5cclxuICAgICAgICB0aGlzLkZpbGVNYW5hZ2VyVXRpbHMgPSBuZXcgRmlsZU1hbmFnZXJVdGlscyh0aGlzKTtcclxuXHJcbiAgICAgICAgdGhpcy5FdmVudEhhbmRsZXJzID0gbmV3IEV2ZW50SGFuZGxlcnModGhpcyk7XHJcbiAgICAgICAgdGhpcy5FdmVudEhhbmRsZXJzLmxvYWRFdmVudEhhbmRsZXJzKCk7XHJcblxyXG4gICAgICAgIC8vQXR1YWxpemEgTW9jU3RyaW5nXHJcbiAgICAgICAgdGhpcy5hZGRDb21tYW5kKHtcclxuICAgICAgICAgICAgaWQ6IFwidXBkYXRlLW1vYy1zdHJpbmdcIixcclxuICAgICAgICAgICAgbmFtZTogXCJVcGRhdGUgTW9jLVN0cmluZyBvbiBDb21tYW5kXCIsXHJcbiAgICAgICAgICAgIGNhbGxiYWNrOiBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBhY3RpdmVGaWxlID0gdGhpcy5hcHAud29ya3NwYWNlLmdldEFjdGl2ZUZpbGUoKTtcclxuICAgICAgICAgICAgICAgIGlmIChhY3RpdmVGaWxlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbW9jQWRtaW5pc3RyYXRvciA9IG5ldyBNb2NBZG1pbmlzdHJhdG9yKHRoaXMsIGFjdGl2ZUZpbGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IG1vY0FkbWluaXN0cmF0b3IudXBkYXRlTW9jTGlua3MoKTtcclxuICAgICAgICAgICAgICAgICAgICBuZXcgTm90aWNlKGBNT0MgTGlua3MgdXBkYXRlZCBmb3IgJHthY3RpdmVGaWxlLm5hbWV9YCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgfSk7XHJcblxyXG5cclxuICAgICAgICAvL1RPRE86IE1ha2UgYSBzZXBhcmF0ZSBmaWxlIGZvciBjb21tYW5kcyBhbmQgaW1wbGVtZW50IHNvbWUgdXNlZnVsIG9uZXMuXHJcbiAgICAgICAgLy8gdGhpcy5hZGRDb21tYW5kKHtcclxuICAgICAgICAvLyAgICAgaWQ6IFwidW5pbmRleC1maWxlXCIsXHJcbiAgICAgICAgLy8gICAgIG5hbWU6IFwiVW5pbmRleCBGaWxlXCIsXHJcbiAgICAgICAgLy8gICAgIGNhbGxiYWNrOiBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgLy8gICAgICAgICBjb25zdCBhY3RpdmVGaWxlID0gdGhpcy5hcHAud29ya3NwYWNlLmdldEFjdGl2ZUZpbGUoKTtcclxuICAgICAgICAvLyAgICAgICAgIGlmIChhY3RpdmVGaWxlKSB7XHJcbiAgICAgICAgLy8gICAgICAgICAgICAgY29uc3QgbW9jQWRtaW5pc3RyYXRvciA9IG5ldyBNb2NBZG1pbmlzdHJhdG9yKHRoaXMsIGFjdGl2ZUZpbGUpO1xyXG4gICAgICAgIC8vICAgICAgICAgICAgIGF3YWl0IG1vY0FkbWluaXN0cmF0b3IudXBkYXRlTW9jTGlua3MoKTtcclxuICAgICAgICAvLyAgICAgICAgICAgICBuZXcgTm90aWNlKGBNT0MgTGlua3MgdXBkYXRlZCBmb3IgJHthY3RpdmVGaWxlLm5hbWV9YCk7XHJcbiAgICAgICAgLy8gICAgICAgICB9XHJcbiAgICAgICAgLy8gICAgIH0sXHJcbiAgICAgICAgLy8gfSk7XHJcblxyXG4gICAgfVxyXG5cclxuXHJcblxyXG4gICAgb251bmxvYWQoKSB7IH1cclxuXHJcbiAgICBhc3luYyBsb2FkU2V0dGluZ3MoKSB7XHJcbiAgICAgICAgdGhpcy5zZXR0aW5ncyA9IE9iamVjdC5hc3NpZ24oXHJcbiAgICAgICAgICAgIHt9LFxyXG4gICAgICAgICAgICBuZXcgREVGQVVMVF9TRVRUSU5HUygpLFxyXG4gICAgICAgICAgICBhd2FpdCB0aGlzLmxvYWREYXRhKClcclxuICAgICAgICApO1xyXG4gICAgICAgIHRoaXMuYWRkU2V0dGluZ1RhYihuZXcgU2V0dGluZ3NUYWIodGhpcy5hcHAsIHRoaXMpKTtcclxuICAgIH1cclxuXHJcbiAgICBhc3luYyBzYXZlU2V0dGluZ3MoKSB7XHJcbiAgICAgICAgYXdhaXQgdGhpcy5zYXZlRGF0YSh0aGlzLnNldHRpbmdzKTtcclxuICAgIH1cclxufSIsICJpbXBvcnQgeyBBcHAsIFRGaWxlLCBURm9sZGVyLCBOb3RpY2UsIFRBYnN0cmFjdEZpbGUgfSBmcm9tICdvYnNpZGlhbic7XHJcbmltcG9ydCBNb2NBZG1pbmlzdHJhdG9yIGZyb20gXCIuL21vYy1tYW5hZ2VtZW50XCI7XHJcbmltcG9ydCBNb2NQbHVnaW4gZnJvbSBcIi4vbWFpblwiO1xyXG5cclxuZXhwb3J0IGNsYXNzIEZpbGVNYW5hZ2VyVXRpbHMge1xyXG4gICAgcHJpdmF0ZSBhcHA6IEFwcDtcclxuICAgIHByaXZhdGUgcGx1Z2luOiBNb2NQbHVnaW47XHJcblxyXG4gICAgY29uc3RydWN0b3IocGx1Z2luaW5qZWN0b3I6IE1vY1BsdWdpbikge1xyXG4gICAgICAgIHRoaXMuYXBwID0gcGx1Z2luaW5qZWN0b3IuYXBwO1xyXG4gICAgICAgIHRoaXMucGx1Z2luID0gcGx1Z2luaW5qZWN0b3I7XHJcbiAgICB9XHJcblxyXG4gICAgYXN5bmMgY3JlYXRlSW5kZXhGaWxlKGZpbGVQYXRoV2l0aE5hbWU6IHN0cmluZywgY29udGVudDogc3RyaW5nLCBwcm9wZXJ0eU5hbWU6IHN0cmluZywgcHJvcGVydHlWYWx1ZTogc3RyaW5nIHwgc3RyaW5nW10sIHRlbXBsYXRlUGF0aE92ZXJ3cml0dGVuPzogc3RyaW5nKTogUHJvbWlzZTxURmlsZSB8IHVuZGVmaW5lZD4ge1xyXG4gICAgICAgIC8vSWYgdGhlcmUncyBhIHRlbXBsYXRlLCB1c2UgaXQhXHJcbiAgICAgICAgbGV0IHRlbXBsYXRlUGF0aCA9IHRlbXBsYXRlUGF0aE92ZXJ3cml0dGVuIHx8IHRoaXMucGx1Z2luLnNldHRpbmdzLnRlbXBsYXRlUGF0aDtcclxuICAgICAgICBpZiAodGVtcGxhdGVQYXRoKSB7XHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB0ZW1wbGF0ZUZpbGUgPSB0aGlzLmFwcC52YXVsdC5nZXRGaWxlQnlQYXRoKHRlbXBsYXRlUGF0aCk7XHJcbiAgICAgICAgICAgICAgICBpZiAodGVtcGxhdGVGaWxlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29udGVudCA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LnJlYWQodGVtcGxhdGVGaWxlKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhjb250ZW50KTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmV3IE5vdGljZShgVGVtcGxhdGUgZmlsZSBub3QgZm91bmQ6ICR7dGVtcGxhdGVQYXRofWApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgbmV3IE5vdGljZShgRXJyb3IgcmVhZGluZyB0ZW1wbGF0ZSBmaWxlOiAke2Vycm9yLm1lc3NhZ2V9YCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgLy9DcmVhdGUgdGhlIE1PQyBmaWxlIHdpdGggdGhlIHNwZWNpZmllZCBjb250ZW50IGFuZCBmcm9udG1hdHRlclxyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGZpbGUgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5jcmVhdGUoZmlsZVBhdGhXaXRoTmFtZSwgY29udGVudCk7XHJcbiAgICAgICAgICAgIG5ldyBOb3RpY2UoYE1PQyBmaWxlIGNyZWF0ZWQ6ICR7ZmlsZVBhdGhXaXRoTmFtZX1gKTtcclxuICAgICAgICAgICAgYXdhaXQgdGhpcy5hcHAuZmlsZU1hbmFnZXIucHJvY2Vzc0Zyb250TWF0dGVyKGZpbGUsIChmcm9udG1hdHRlcikgPT4ge1xyXG4gICAgICAgICAgICAgICAgZnJvbnRtYXR0ZXJbcHJvcGVydHlOYW1lXSA9IHByb3BlcnR5VmFsdWU7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBjb25zdCBtb2NBZG1pbmlzdHJhdG9yID0gbmV3IE1vY0FkbWluaXN0cmF0b3IodGhpcy5wbHVnaW4sIGZpbGUpO1xyXG4gICAgICAgICAgICBtb2NBZG1pbmlzdHJhdG9yLmNvbm5lY3QoKTtcclxuICAgICAgICAgICAgYXdhaXQgbW9jQWRtaW5pc3RyYXRvci5tb2NJbmplY3RvclRvRmlsZSgpO1xyXG5cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBmaWxlO1xyXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICAgIG5ldyBOb3RpY2UoYEVycm9yIGNyZWF0aW5nIE1PQyBmaWxlOiAke2Vycm9yLm1lc3NhZ2V9YCk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY3JlYXRlSW5kZXhGaWxlTmFtZUFuZFBhdGgoZm9sZGVyOiBURm9sZGVyKTogc3RyaW5nIHtcclxuICAgICAgICBmb2xkZXIgPSBmb2xkZXIgfHwgdGhpcy5hcHAudmF1bHQuZ2V0Um9vdCgpO1xyXG4gICAgICAgIGxldCBmb2xkZXJOYW1lQ29weSA9IGZvbGRlcj8ubmFtZS5yZXBsYWNlKC9cXHB7RW1vamlfUHJlc2VudGF0aW9ufS9ndSwgXCJcIik7XHJcbiAgICAgICAgaWYgKGZvbGRlci5pc1Jvb3QoKSkge1xyXG4gICAgICAgICAgICBmb2xkZXJOYW1lQ29weSA9IGZvbGRlci52YXVsdC5nZXROYW1lKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBgJHtmb2xkZXIuaXNSb290KCkgPyBcIlwiIDogZm9sZGVyLnBhdGggKyBcIi9cIn0ke3RoaXMucGx1Z2luLnNldHRpbmdzLmluZGV4RmlsZVByZWZpeH0ke3RoaXMucGx1Z2luLnNldHRpbmdzLmF1dG9SZW5hbWVJbmRleEZpbGUgPyBmb2xkZXJOYW1lQ29weS50cmltKCkgOiBcIlwifSR7dGhpcy5wbHVnaW4uc2V0dGluZ3MuaW5kZXhGaWxlU3VmZml4fS5tZGA7XHJcbiAgICB9XHJcblxyXG4gICAgYXN5bmMgZmlsZUF1dG9SZW5hbWluZyhmaWxlOiBURmlsZSwgdHJhY2tSZW5hbWU/OiAob2xkUGF0aDogc3RyaW5nKSA9PiB2b2lkKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmlzSW5kZXhGaWxlKGZpbGUpKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGZpbGVFeGlzdHMgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5hZGFwdGVyLmV4aXN0cyhmaWxlLnBhdGgpO1xyXG4gICAgICAgIGlmICghZmlsZUV4aXN0cykge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBwYXJlbnRGb2xkZXIgPSB0aGlzLmdldERpcmVjdFBhcmVudChmaWxlKTtcclxuICAgICAgICBjb25zdCBuZXdGaWxlTmFtZSA9IHRoaXMuY3JlYXRlSW5kZXhGaWxlTmFtZUFuZFBhdGgocGFyZW50Rm9sZGVyKTtcclxuXHJcbiAgICAgICAgaWYgKG5ld0ZpbGVOYW1lICE9PSBmaWxlLnBhdGgpIHtcclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgIGlmICh0cmFja1JlbmFtZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRyYWNrUmVuYW1lKGZpbGUucGF0aCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5hcHAuZmlsZU1hbmFnZXIucmVuYW1lRmlsZShmaWxlLCBuZXdGaWxlTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3QgbmV3RmlsZU5hbWVPbmx5ID0gbmV3RmlsZU5hbWUuc3BsaXQoXCIvXCIpLnBvcCgpIHx8IFwiXCI7XHJcbiAgICAgICAgICAgICAgICBpZiAobmV3RmlsZU5hbWVPbmx5ICE9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmV3IE5vdGljZShgSW5kZXggZmlsZSByZW5hbWVkIHRvOiAke25ld0ZpbGVOYW1lT25seX1gKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciByZW5hbWluZyBpbmRleCBmaWxlOlwiLCBlcnJvcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgYXN5bmMgcmVhZEZpbGVNZXRhZGF0YShmaWxlOiBURmlsZSkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmFwcC5tZXRhZGF0YUNhY2hlLmdldEZpbGVDYWNoZShmaWxlKTtcclxuICAgIH1cclxuXHJcbiAgICBmaWx0ZXJGaWxlc0J5UHJvcGVydHkocHJvcGVydHlOYW1lOiBzdHJpbmcsIHByb3BlcnR5VmFsdWU6IGFueSk6IFRGaWxlW10ge1xyXG4gICAgICAgIGNvbnN0IGZpbGVzID0gdGhpcy5hcHAudmF1bHQuZ2V0TWFya2Rvd25GaWxlcygpO1xyXG4gICAgICAgIGNvbnN0IGZpbHRlcmVkRmlsZXM6IFRGaWxlW10gPSBbXTtcclxuXHJcbiAgICAgICAgZm9yIChjb25zdCBmaWxlIG9mIGZpbGVzKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1ldGFkYXRhID0gdGhpcy5hcHAubWV0YWRhdGFDYWNoZS5nZXRGaWxlQ2FjaGUoZmlsZSk7XHJcbiAgICAgICAgICAgIGlmIChtZXRhZGF0YSAmJiBtZXRhZGF0YS5mcm9udG1hdHRlcikge1xyXG4gICAgICAgICAgICAgICAgaWYgKG1ldGFkYXRhLmZyb250bWF0dGVyW3Byb3BlcnR5TmFtZV0gPT09IHByb3BlcnR5VmFsdWUgfHxcclxuICAgICAgICAgICAgICAgICAgICBtZXRhZGF0YS5mcm9udG1hdHRlcltwcm9wZXJ0eU5hbWVdPy5pbmNsdWRlcyhwcm9wZXJ0eVZhbHVlKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGZpbHRlcmVkRmlsZXMucHVzaChmaWxlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGZpbHRlcmVkRmlsZXM7XHJcbiAgICB9XHJcblxyXG4gICAgYXN5bmMgZm9sZGVyQXV0b1JlbmFtaW5nKGFic0ZpbGU6IFRGb2xkZXIsIHRyYWNrUmVuYW1lPzogKG9sZFBhdGg6IHN0cmluZykgPT4gdm9pZCk6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgICAgIGlmIChhYnNGaWxlIGluc3RhbmNlb2YgVEZvbGRlcikge1xyXG4gICAgICAgICAgICBjb25zdCBmb2xkZXIgPSBhYnNGaWxlIGFzIFRGb2xkZXI7XHJcbiAgICAgICAgICAgIGNvbnN0IGZvbGRlck5hbWUgPSB0aGlzLmluc2VydEVtb2ppSW5Gb2xkZXJOYW1lKGZvbGRlci5uYW1lKTtcclxuICAgICAgICAgICAgaWYgKGZvbGRlck5hbWUgIT09IGZvbGRlci5uYW1lKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdQYXRoID0gYCR7Zm9sZGVyLnBhcmVudD8ucGF0aCA/IGZvbGRlci5wYXJlbnQucGF0aCArIFwiL1wiIDogXCJcIn0ke2ZvbGRlck5hbWV9YDtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBUcmFjayB0aGF0IHdlJ3JlIGFib3V0IHRvIHJlbmFtZSB0aGlzIGZvbGRlclxyXG4gICAgICAgICAgICAgICAgaWYgKHRyYWNrUmVuYW1lKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdHJhY2tSZW5hbWUoZm9sZGVyLnBhdGgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuYXBwLmZpbGVNYW5hZ2VyLnJlbmFtZUZpbGUoZm9sZGVyLCBuZXdQYXRoKTtcclxuICAgICAgICAgICAgICAgIG5ldyBOb3RpY2UoYEZvbGRlciByZW5hbWVkIHRvOiAke2ZvbGRlck5hbWV9YCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxuICAgIGdldERpcmVjdFBhcmVudChBYnNGaWxlOiBUQWJzdHJhY3RGaWxlKTogVEZvbGRlciB7XHJcbiAgICAgICAgbGV0IHBhcmVudCA9IEFic0ZpbGUucGFyZW50O1xyXG4gICAgICAgIGlmICghcGFyZW50KSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmFwcC52YXVsdC5nZXRSb290KCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gcGFyZW50O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcblxyXG4gICAgaXNJbmRleEZpbGUoYWJzRmlsZTogVEFic3RyYWN0RmlsZSk6IGJvb2xlYW4ge1xyXG4gICAgICAgIGlmIChhYnNGaWxlIGluc3RhbmNlb2YgVEZpbGUpIHtcclxuICAgICAgICAgICAgY29uc3QgbWV0YWRhdGEgPSB0aGlzLmFwcC5tZXRhZGF0YUNhY2hlLmdldEZpbGVDYWNoZShhYnNGaWxlKTtcclxuICAgICAgICAgICAgY29uc3QgcHJvcGVydHlOYW1lID0gdGhpcy5wbHVnaW4uc2V0dGluZ3MubW9jUHJvcGVydHlLZXk7XHJcbiAgICAgICAgICAgIGNvbnN0IHByb3BlcnR5VmFsdWUgPSB0aGlzLnBsdWdpbi5zZXR0aW5ncy5tb2NQcm9wZXJ0eVZhbHVlO1xyXG5cclxuICAgICAgICAgICAgaWYgKG1ldGFkYXRhICYmIG1ldGFkYXRhLmZyb250bWF0dGVyKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbWV0YWRhdGEuZnJvbnRtYXR0ZXJbcHJvcGVydHlOYW1lXSA9PT0gcHJvcGVydHlWYWx1ZSAmJlxyXG4gICAgICAgICAgICAgICAgICAgIE9iamVjdC5rZXlzKG1ldGFkYXRhLmZyb250bWF0dGVyKS5pbmNsdWRlcyhwcm9wZXJ0eU5hbWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgaW5zZXJ0RW1vamlJbkZvbGRlck5hbWUoZm9sZGVyTmFtZTogc3RyaW5nKTogc3RyaW5nIHtcclxuICAgICAgICBjb25zdCBlbW9qaSA9IHRoaXMucGx1Z2luLnNldHRpbmdzLmF1dG9Gb2xkZXJFbW9qaTtcclxuICAgICAgICBpZiAoZm9sZGVyTmFtZS5zdGFydHNXaXRoKGVtb2ppKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZm9sZGVyTmFtZTsgLy8gTm8gY2hhbmdlIG5lZWRlZCBpZiBpdCBhbHJlYWR5IHN0YXJ0cyB3aXRoIHRoZSBlbW9qaVxyXG4gICAgICAgIH1cclxuICAgICAgICBmb2xkZXJOYW1lID0gZm9sZGVyTmFtZS5yZXBsYWNlKC9cXHB7RW1vamlfUHJlc2VudGF0aW9ufS9ndSwgXCJcIik7XHJcblxyXG4gICAgICAgIHJldHVybiBlbW9qaSA/IGAke2Vtb2ppfSR7Zm9sZGVyTmFtZX1gIDogZm9sZGVyTmFtZTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIE9idFx1MDBFOW0gbyBjYW1pbmhvIGRhIHBhc3RhIGJhc2UgcGFyYSBhIHNlc3NcdTAwRTNvIGRlIHJlbmFtZVxyXG4gICAgICovXHJcbiAgICBnZXRCYXNlRm9sZGVyUGF0aChhYnNGaWxlOiBUQWJzdHJhY3RGaWxlLCBvbGRQYXRoOiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgICAgIGlmIChhYnNGaWxlIGluc3RhbmNlb2YgVEZvbGRlcikge1xyXG4gICAgICAgICAgICByZXR1cm4gb2xkUGF0aDtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gUGFyYSBhcnF1aXZvcywgb2J0ZXIgbyBjYW1pbmhvIGRhIHBhc3RhIHBhaVxyXG4gICAgICAgIHJldHVybiBvbGRQYXRoLnN1YnN0cmluZygwLCBvbGRQYXRoLmxhc3RJbmRleE9mKCcvJykpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogRGV0ZXJtaW5hIHNlIGEgcGFzdGEgcmVub21lYWRhIFx1MDBFOSBhIHBhc3RhIHJhaXogc2VuZG8gcmVub21lYWRhIHBlbG8gdXN1XHUwMEUxcmlvLFxyXG4gICAgICogblx1MDBFM28gdW1hIHBhc3RhIGZpbGhhIGFmZXRhZGEgcG9yIHVtIHJlbmFtZSBkZSBwYXN0YSBwYWlcclxuICAgICAqL1xyXG4gICAgaXNSb290UmVuYW1lZEZvbGRlcihyZW5hbWVkRm9sZGVyOiBURm9sZGVyLCBvbGRQYXRoOiBzdHJpbmcpOiBib29sZWFuIHtcclxuICAgICAgICBjb25zdCBvbGRQYXJlbnRQYXRoID0gb2xkUGF0aC5zdWJzdHJpbmcoMCwgb2xkUGF0aC5sYXN0SW5kZXhPZignLycpKTtcclxuICAgICAgICBjb25zdCBuZXdQYXJlbnRQYXRoID0gcmVuYW1lZEZvbGRlci5wYXRoLnN1YnN0cmluZygwLCByZW5hbWVkRm9sZGVyLnBhdGgubGFzdEluZGV4T2YoJy8nKSk7XHJcblxyXG4gICAgICAgIC8vIFNlIGNhbWluaG9zIHBhaSBzXHUwMEUzbyBpZ3VhaXMsIGVzdGUgXHUwMEU5IHVtIHJlbmFtZSBkaXJldG8sIG5cdTAwRTNvIHVtIHJlbmFtZSBjYXNjYXRlYWRvXHJcbiAgICAgICAgcmV0dXJuIG9sZFBhcmVudFBhdGggPT09IG5ld1BhcmVudFBhdGg7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBOb3JtYWxpemEgdW0gY2FtaW5obyByZW1vdmVuZG8gYmFycmFzIG5vIGluXHUwMEVEY2lvIGUgZmltXHJcbiAgICAgKi9cclxuICAgIG5vcm1hbGl6ZVBhdGgocGF0aDogc3RyaW5nKTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gcGF0aC5yZXBsYWNlKC9eXFwvK3xcXC8rJC9nLCAnJyk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBWZXJpZmljYSBzZSB1bSBjYW1pbmhvIFx1MDBFOSBmaWxobyBkZSB1bWEgcGFzdGEgYmFzZVxyXG4gICAgICovXHJcbiAgICBpc0NoaWxkT2ZQYXRoKGNoaWxkUGF0aDogc3RyaW5nLCBiYXNlUGF0aDogc3RyaW5nKTogYm9vbGVhbiB7XHJcbiAgICAgICAgY29uc3Qgbm9ybWFsaXplZEJhc2UgPSB0aGlzLm5vcm1hbGl6ZVBhdGgoYmFzZVBhdGgpO1xyXG4gICAgICAgIGNvbnN0IG5vcm1hbGl6ZWRDaGlsZCA9IHRoaXMubm9ybWFsaXplUGF0aChjaGlsZFBhdGgpO1xyXG5cclxuICAgICAgICByZXR1cm4gbm9ybWFsaXplZENoaWxkID09PSBub3JtYWxpemVkQmFzZSB8fCBub3JtYWxpemVkQ2hpbGQuc3RhcnRzV2l0aChub3JtYWxpemVkQmFzZSArICcvJyk7XHJcbiAgICB9XHJcblxyXG59IiwgImltcG9ydCB7IFRGaWxlLCBBcHAsIE5vdGljZSwgVEZvbGRlciB9IGZyb20gXCJvYnNpZGlhblwiO1xyXG5pbXBvcnQgTW9jUGx1Z2luIGZyb20gXCIuL21haW5cIjtcclxuaW1wb3J0IHsgRmlsZU1hbmFnZXJVdGlscyB9IGZyb20gJy4vZmlsZS1tYW5hZ2VyLXV0aWxzJztcclxuaW1wb3J0IHsgRklMRV9QQVRURVJOUywgREVGQVVMVF9DT05GSUcgfSBmcm9tICcuL2NvbnN0YW50cyc7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBNb2NBZG1pbmlzdHJhdG9yIHtcclxuICAgIHNlbGZfZmlsZTogVEZpbGUgO1xyXG4gICAgTW9jTGlua3M6IHtcclxuICAgICAgICBwYXJlbnQ6IFRGaWxlIHwgbnVsbCB8IHVuZGVmaW5lZDtcclxuICAgICAgICBjaGlsZHJlbjogVEZpbGVbXSB8IG51bGwgfCB1bmRlZmluZWQ7XHJcbiAgICAgICAgZmlsZXM6IFRGaWxlW10gfCBudWxsIHwgdW5kZWZpbmVkO1xyXG4gICAgfVxyXG4gICAgc2V0dGluZ3NcclxuICAgIHBsdWdpbjogTW9jUGx1Z2luO1xyXG4gICAgZmlsZU1hbmFnZXI6IEZpbGVNYW5hZ2VyVXRpbHM7XHJcbiAgICBhcHA6IEFwcDtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihwbHVnaW5JbmplY3RvcjogTW9jUGx1Z2luLCBzZWxmX2ZpbGU6IFRGaWxlKSB7XHJcbiAgICAgICAgdGhpcy5hcHAgPSBwbHVnaW5JbmplY3Rvci5hcHA7XHJcbiAgICAgICAgdGhpcy5wbHVnaW4gPSBwbHVnaW5JbmplY3RvcjtcclxuICAgICAgICB0aGlzLnNlbGZfZmlsZSA9IHNlbGZfZmlsZTtcclxuICAgICAgICB0aGlzLnNldHRpbmdzID0gcGx1Z2luSW5qZWN0b3Iuc2V0dGluZ3NcclxuICAgICAgICB0aGlzLmZpbGVNYW5hZ2VyID0gbmV3IEZpbGVNYW5hZ2VyVXRpbHMocGx1Z2luSW5qZWN0b3IpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbm5lY3QoKSB7XHJcbiAgICAgICAgLy8gY29uc3QgbW9jU3RyaW5nID0gYXdhaXQgdGhpcy5nZXRNb2NTdHJpbmcoKTtcclxuICAgICAgICAvL0lmIE1PQyBTVFJJTkcgaXMgZW1wdHksIGNyZWF0ZSBhIG5ldyBvbmUgKEluamVjdGlvbikgLSBTZXJcdTAwRTEgcXVlIGV1IGZhXHUwMEU3byBpc3NvIGp1bnRvP1xyXG4gICAgICAgIHRoaXMuTW9jTGlua3MgPSB0aGlzLmdlbmVyYXRlTW9jQ29ubmVjdGlvbnMoKTtcclxuICAgICAgICAvLyBhd2FpdCB0aGlzLnBhcnNlTW9jU3RyaW5nKG1vY1N0cmluZyk7XHJcbiAgICB9XHJcblxyXG4gICAgYXN5bmMgZGVsZXRlTW9jU3RyaW5nKHJlc2V0TGluZXM6IGJvb2xlYW4gPSB0cnVlKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICAgICAgbGV0IG1vY1JlZ2V4OiBSZWdFeHA7XHJcbiAgICAgICAgaWYgKHJlc2V0TGluZXMpIHtcclxuICAgICAgICAgICAgbW9jUmVnZXggPSAvKCg/Ol5bIFxcdF0qXFxyP1xcbikqKV4tLS1bXFxzXFxyXFxuXSo8c3BhbiBjbGFzcz1cIm1vYy1wbHVnaW4tc3RhcnRcIj5NT0MgTGlua3M6PFxcL3NwYW4+W1xcc1xcU10qPzxzcGFuIGNsYXNzPVwibW9jLXBsdWdpbi1lbmRcIj5cXHMqPFxcL3NwYW4+W1xcc1xcclxcbl0qLS0tW1xcc1xcclxcbl0qKCg/Ol5bIFxcdF0qXFxyP1xcbikqKSQvZ207XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBtb2NSZWdleCA9IC9eLS0tW1xcc1xcclxcbl0qPHNwYW4gY2xhc3M9XCJtb2MtcGx1Z2luLXN0YXJ0XCI+TU9DIExpbmtzOjxcXC9zcGFuPltcXHNcXFNdKj88c3BhbiBjbGFzcz1cIm1vYy1wbHVnaW4tZW5kXCI+XFxzKjxcXC9zcGFuPltcXHNcXHJcXG5dKi0tLVtcXHNcXHJcXG5dKi9nbTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgdGhpcy5hcHAudmF1bHQucHJvY2Vzcyh0aGlzLnNlbGZfZmlsZSwgKGNvbnRlbnQpID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBjb250ZW50LnJlcGxhY2UobW9jUmVnZXgsIFwiXCIpO1xyXG4gICAgICAgICAgICB9KS5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZGVsZXRpbmcgTU9DIHN0cmluZzpcIiwgZXJyKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycilcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZ2VuZXJhdGVNb2NDb25uZWN0aW9ucygpOiB0eXBlb2YgdGhpcy5Nb2NMaW5rcyB7XHJcbiAgICAgICAgY29uc3QgbW9jTGlua3M6IHR5cGVvZiB0aGlzLk1vY0xpbmtzID0ge1xyXG4gICAgICAgICAgICBwYXJlbnQ6IHRoaXMuZ2V0UGFyZW50TGluaygpLFxyXG4gICAgICAgICAgICBjaGlsZHJlbjogdGhpcy5nZXRDaGlsZHJlbkxpbmtzKCksXHJcbiAgICAgICAgICAgIGZpbGVzOiB0aGlzLmdldEZpbGVzTGlua3MoKVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIG1vY0xpbmtzO1xyXG4gICAgfVxyXG5cclxuICAgIGFzeW5jIHVwZGF0ZU1vY0xpbmtzKCkge1xyXG4gICAgICAgIGF3YWl0IHRoaXMuZGVsZXRlTW9jU3RyaW5nKGZhbHNlKTtcclxuICAgICAgICBhd2FpdCB0aGlzLm1vY0luamVjdG9yVG9GaWxlKDApO1xyXG4gICAgfVxyXG5cclxuICAgIGFzeW5jIG1vY0xpbmtzQXV0b1VwZGF0ZSgpOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgICAgICBpZiAodGhpcy5maWxlTWFuYWdlci5pc0luZGV4RmlsZSh0aGlzLnNlbGZfZmlsZSkpIHtcclxuICAgICAgICAgICAgLy8gVmVyaWZpY2Egc2UgbyBhcnF1aXZvIGFpbmRhIGV4aXN0ZSBhbnRlcyBkZSBwcm9jZXNzYXJcclxuICAgICAgICAgICAgY29uc3QgZmlsZUV4aXN0cyA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LmFkYXB0ZXIuZXhpc3RzKHRoaXMuc2VsZl9maWxlLnBhdGgpO1xyXG4gICAgICAgICAgICBpZiAoIWZpbGVFeGlzdHMpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihgRmlsZSAke3RoaXMuc2VsZl9maWxlLnBhdGh9IG5vIGxvbmdlciBleGlzdHMsIHNraXBwaW5nIE1PQyB1cGRhdGVgKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG1vY0FkbWluaXN0cmF0b3IgPSBuZXcgTW9jQWRtaW5pc3RyYXRvcih0aGlzLnBsdWdpbiwgdGhpcy5zZWxmX2ZpbGUgYXMgVEZpbGUpO1xyXG4gICAgICAgICAgICAgICAgbW9jQWRtaW5pc3RyYXRvci5jb25uZWN0KCk7XHJcbiAgICAgICAgICAgICAgICBhd2FpdCBtb2NBZG1pbmlzdHJhdG9yLnVwZGF0ZU1vY0xpbmtzKCk7XHJcbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGBFcnJvciB1cGRhdGluZyBNT0MgZm9yICR7dGhpcy5zZWxmX2ZpbGUucGF0aH06YCwgZXJyb3IpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGFzeW5jIHVwZGF0ZUluZGV4TW9jVHJlZSgpOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgICAgICBjb25zdCBmaWxlcyA9IHRoaXMuYXBwLnZhdWx0LmdldE1hcmtkb3duRmlsZXMoKS5maWx0ZXIoZmlsZSA9PiB0aGlzLmZpbGVNYW5hZ2VyLmlzSW5kZXhGaWxlKGZpbGUpKTtcclxuXHJcbiAgICAgICAgZm9yIChjb25zdCBmaWxlIG9mIGZpbGVzKSB7XHJcbiAgICAgICAgICAgIC8vIFZlcmlmaWNhIHNlIG8gYXJxdWl2byBhaW5kYSBleGlzdGUgYW50ZXMgZGUgcHJvY2Vzc2FyXHJcbiAgICAgICAgICAgIGNvbnN0IGZpbGVFeGlzdHMgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5hZGFwdGVyLmV4aXN0cyhmaWxlLnBhdGgpO1xyXG4gICAgICAgICAgICBpZiAoZmlsZUV4aXN0cykge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgbW9jQWRtaW5pc3RyYXRvciA9IG5ldyBNb2NBZG1pbmlzdHJhdG9yKHRoaXMucGx1Z2luLCBmaWxlKTtcclxuICAgICAgICAgICAgICAgIG1vY0FkbWluaXN0cmF0b3IuY29ubmVjdCgpO1xyXG4gICAgICAgICAgICAgICAgYXdhaXQgbW9jQWRtaW5pc3RyYXRvci51cGRhdGVNb2NMaW5rcygpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKGBGaWxlICR7ZmlsZS5wYXRofSBubyBsb25nZXIgZXhpc3RzLCBza2lwcGluZyBpbiB1cGRhdGVJbmRleE1vY1RyZWVgKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG5cclxuXHJcbiAgICAvL1VwZGF0ZXMgRmlsZXMgaW5zaWRlIHRoZSBPYmplY3RBZG1pbmlzdHJhdG9yXHJcbiAgICBnZXRGaWxlc0xpbmtzKHNlbGZfZmlsZSA9IHRoaXMuc2VsZl9maWxlKTogdHlwZW9mIHRoaXMuTW9jTGlua3MuZmlsZXMge1xyXG4gICAgICAgIGxldCBmaWxlc0FycjogdHlwZW9mIHRoaXMuTW9jTGlua3MuZmlsZXMgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgLy8gQ2FzbyBvIHBhaSBzZWphIG8gcm9vdCwgcGVnYSB0b2RvcyBvcyBhcnF1aXZvcyBkbyBkaXJldFx1MDBGM3JpbyByYVx1MDBFRHpcclxuICAgICAgICBpZiAoIXNlbGZfZmlsZS5wYXJlbnQpIHtcclxuICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxyXG4gICAgICAgICAgICBmaWxlc0FyciA9IHRoaXMuYXBwLnZhdWx0LmdldFJvb3QoKS5jaGlsZHJlbi5maWx0ZXIoKGFic0ZpbGUpID0+IGFic0ZpbGUgaW5zdGFuY2VvZiBURmlsZSAmJiBhYnNGaWxlLnBhdGggIT09IHNlbGZfZmlsZS5wYXRoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcclxuICAgICAgICAgICAgZmlsZXNBcnIgPSBzZWxmX2ZpbGUucGFyZW50LmNoaWxkcmVuLmZpbHRlcigoYWJzRmlsZSkgPT4gYWJzRmlsZSBpbnN0YW5jZW9mIFRGaWxlICYmIGFic0ZpbGUucGF0aCAhPT0gc2VsZl9maWxlLnBhdGgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIWZpbGVzQXJyIHx8IGZpbGVzQXJyLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBmaWxlc0FycjtcclxuICAgIH1cclxuXHJcbiAgICBnZXRQYXJlbnRMaW5rKHNlbGZfZmlsZSA9IHRoaXMuc2VsZl9maWxlKSB7XHJcbiAgICAgICAgbGV0IHBhcmVudEZvbGRlciA9IHNlbGZfZmlsZS5wYXJlbnQ7XHJcbiAgICAgICAgaWYgKCFwYXJlbnRGb2xkZXIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHBhcmVudEZvbGRlciA9IHBhcmVudEZvbGRlci5wYXJlbnQ7XHJcbiAgICAgICAgd2hpbGUgKHBhcmVudEZvbGRlcikge1xyXG4gICAgICAgICAgICAvLyBAdHMtaWdub3JlXHJcbiAgICAgICAgICAgIGNvbnN0IGluZGV4RmlsZXNDaGlsZHJlbjogVEZpbGVbXSA9IHBhcmVudEZvbGRlci5jaGlsZHJlbi5maWx0ZXIoKGNoaWxkKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2hpbGQgaW5zdGFuY2VvZiBURmlsZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGZyb250bWF0dGVyQ29weSA9IHRoaXMuYXBwLm1ldGFkYXRhQ2FjaGUuZ2V0RmlsZUNhY2hlKGNoaWxkKT8uZnJvbnRtYXR0ZXI7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9DaGVjayBpZiB0aGUgZnJvbnRtYXR0ZXIgaGFzIHRoZSBtb2NQcm9wZXJ0eUtleSBhbmQgbW9jUHJvcGVydHlWYWx1ZVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChmcm9udG1hdHRlckNvcHkgJiYgZnJvbnRtYXR0ZXJDb3B5W3RoaXMuc2V0dGluZ3MubW9jUHJvcGVydHlLZXldID09PSB0aGlzLnNldHRpbmdzLm1vY1Byb3BlcnR5VmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgaWYgKGluZGV4RmlsZXNDaGlsZHJlbi5sZW5ndGggPT09IDEpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBpbmRleEZpbGVzQ2hpbGRyZW5bMF07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAoaW5kZXhGaWxlc0NoaWxkcmVuLmxlbmd0aCA+IDEpIHtcclxuICAgICAgICAgICAgICAgIC8vIG5ldyBOb3RpY2UoYE11bHRpcGxlIEluZGV4IEZpbGVzIHdpdGggTU9DIGZvdW5kIGluc2lkZSBmb2xkZXI6ICR7cGFyZW50Rm9sZGVyLnBhdGh9XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgVGhpcyBtaWdodCBsZWFkIHRvIGVycm9ycyBpbiB0aGUgcGx1Z2luLmApO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGluZGV4RmlsZXNDaGlsZHJlblswXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBwYXJlbnRGb2xkZXIgPSBwYXJlbnRGb2xkZXIucGFyZW50O1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBuZXcgTm90aWNlKFwiQ2FuJ3QgZmluZCBwYXJlbnQgTU9DIGZpbGUgZm9yOiBcIiArIHNlbGZfZmlsZS5uYW1lKTtcclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuXHJcblxyXG4gICAgZ2V0Q2hpbGRyZW5MaW5rcyhzZWxmX2ZpbGUgPSB0aGlzLnNlbGZfZmlsZSkge1xyXG4gICAgICAgIGNvbnN0IHBhcmVudEZvbGRlciA9IHRoaXMuZmlsZU1hbmFnZXIuZ2V0RGlyZWN0UGFyZW50KHNlbGZfZmlsZSk7XHJcbiAgICAgICAgbGV0IGNoaWxkcmVuTGlua3M6IFRGaWxlW10gPSBbXTtcclxuICAgICAgICBjb25zdCByZWN1cnNpdmVDaGlsZHJlbkZpbmRlciA9IChzdGFydGluZ0ZvbGRlcjogVEZvbGRlcikgPT4ge1xyXG4gICAgICAgICAgICBsZXQgZGlyZWN0Q2hpbGRyZW5Gb2xkZXJzOiBURm9sZGVyW10gPSBbXTtcclxuICAgICAgICAgICAgbGV0IGRpcmVjdENoaWxkcmVuRmlsZXM6IFRGaWxlW10gPSBbXTtcclxuICAgICAgICAgICAgc3RhcnRpbmdGb2xkZXIuY2hpbGRyZW4uZm9yRWFjaCgoY2hpbGQpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChjaGlsZCBpbnN0YW5jZW9mIFRGaWxlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZnJvbnRtYXR0ZXJDb3B5ID0gdGhpcy5hcHAubWV0YWRhdGFDYWNoZS5nZXRGaWxlQ2FjaGUoY2hpbGQpPy5mcm9udG1hdHRlcjtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZnJvbnRtYXR0ZXJDb3B5ICYmIGZyb250bWF0dGVyQ29weVt0aGlzLnNldHRpbmdzLm1vY1Byb3BlcnR5S2V5XSA9PT0gdGhpcy5zZXR0aW5ncy5tb2NQcm9wZXJ0eVZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpcmVjdENoaWxkcmVuRmlsZXMucHVzaChjaGlsZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoY2hpbGQgaW5zdGFuY2VvZiBURm9sZGVyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGlyZWN0Q2hpbGRyZW5Gb2xkZXJzLnB1c2goY2hpbGQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgaWYgKGRpcmVjdENoaWxkcmVuRmlsZXMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICBkaXJlY3RDaGlsZHJlbkZvbGRlcnMuZm9yRWFjaCgoZm9sZGVyKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVjdXJzaXZlQ2hpbGRyZW5GaW5kZXIoZm9sZGVyKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChkaXJlY3RDaGlsZHJlbkZpbGVzLmxlbmd0aCA+IDEpIHtcclxuICAgICAgICAgICAgICAgIC8vIG5ldyBOb3RpY2UoYE11bHRpcGxlIE1PQyBmaWxlcyBmb3VuZCBpbiBzaW5nbGUgZm9sZGVyOiAke3N0YXJ0aW5nRm9sZGVyLnBhdGh9YCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGNoaWxkcmVuTGlua3MgPSBbLi4uY2hpbGRyZW5MaW5rcywgLi4uZGlyZWN0Q2hpbGRyZW5GaWxlc107XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHBhcmVudEZvbGRlci5jaGlsZHJlbi5mb3JFYWNoKChjaGlsZCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoY2hpbGQgaW5zdGFuY2VvZiBURm9sZGVyKSB7XHJcbiAgICAgICAgICAgICAgICByZWN1cnNpdmVDaGlsZHJlbkZpbmRlcihjaGlsZCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaWYgKGNoaWxkcmVuTGlua3MubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgIC8vIG5ldyBOb3RpY2UoXCJObyBjaGlsZHJlbiBNT0MgZmlsZXMgZm91bmQgaW4gdGhlIGN1cnJlbnQgZm9sZGVyLlwiKTtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gY2hpbGRyZW5MaW5rcztcclxuICAgIH1cclxuXHJcblxyXG4gICAgbW9jU3RyaW5nR2VuZXJhdG9yKCk6IHN0cmluZyB7XHJcbiAgICAgICAgY29uc3QgaGVhZGVyID0gdGhpcy5zZXR0aW5ncy5tb2NIZWFkZXI7XHJcbiAgICAgICAgY29uc3QgeyBwYXJlbnQsIGNoaWxkcmVuLCBmaWxlcyB9ID0gdGhpcy5Nb2NMaW5rcztcclxuICAgICAgICBjb25zdCBwYXJlbnRMaW5rU3RyaW5nID0gcGFyZW50ID8gYCR7dGhpcy5hcHAuZmlsZU1hbmFnZXIuZ2VuZXJhdGVNYXJrZG93bkxpbmsocGFyZW50LCB0aGlzLnNlbGZfZmlsZS5wYXRoKX1gIDogXCIqTm9uZSpcIjtcclxuICAgICAgICBjb25zdCBjaGlsZHJlbkxpbmtzU3RyaW5nID0gY2hpbGRyZW4gJiYgY2hpbGRyZW4ubGVuZ3RoID4gMCA/IGNoaWxkcmVuLm1hcChjaGlsZCA9PiBgLSAke3RoaXMuYXBwLmZpbGVNYW5hZ2VyLmdlbmVyYXRlTWFya2Rvd25MaW5rKGNoaWxkLCB0aGlzLnNlbGZfZmlsZS5wYXRoKX1gKS5qb2luKFwiXFxuXCIpIDogXCItICpOb25lKlwiO1xyXG4gICAgICAgIGNvbnN0IGZpbGVzTGlua3NTdHJpbmcgPSBmaWxlcyAmJiBmaWxlcy5sZW5ndGggPiAwID8gZmlsZXMubWFwKGZpbGUgPT4gYC0gJHt0aGlzLmFwcC5maWxlTWFuYWdlci5nZW5lcmF0ZU1hcmtkb3duTGluayhmaWxlLCB0aGlzLnNlbGZfZmlsZS5wYXRoKX1gKS5qb2luKFwiXFxuXCIpIDogXCItICpOb25lKlwiO1xyXG4gICAgICAgIGNvbnN0IG1vY1N0cmluZyA9IGAtLS1cclxuJHtGSUxFX1BBVFRFUk5TLk1PQ19TUEFOX1NUQVJUfSR7aGVhZGVyfTwvc3Bhbj5cclxuIyMjIyBQYXJlbnQ6XHJcbi0gJHtwYXJlbnRMaW5rU3RyaW5nfVxyXG4jIyMjIENoaWxkcmVuOlxyXG4ke2NoaWxkcmVuTGlua3NTdHJpbmd9XHJcbiMjIyMgRmlsZXM6XHJcbiR7ZmlsZXNMaW5rc1N0cmluZ31cclxuJHtGSUxFX1BBVFRFUk5TLk1PQ19TUEFOX0VORH1cclxuLS0tYDtcclxuXHJcbiAgICAgICAgcmV0dXJuIG1vY1N0cmluZztcclxuICAgIH1cclxuXHJcbiAgICBhc3luYyBtb2NJbmplY3RvclRvRmlsZShsaW5lQnJlYWtzOiBudW1iZXIgPSBERUZBVUxUX0NPTkZJRy5MSU5FX0JSRUFLU19ERUZBVUxUKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgY29uc3QgbW9jID0gdGhpcy5tb2NTdHJpbmdHZW5lcmF0b3IoKTtcclxuICAgICAgICAgICAgLy8gRXNjcmV2ZSBkZSB2b2x0YSBvIGNvbnRlXHUwMEZBZG9cclxuICAgICAgICAgICAgY29uc3QgcmV0dXJuVmFsdWUgPSB0aGlzLmFwcC52YXVsdC5wcm9jZXNzKHRoaXMuc2VsZl9maWxlLCAoY29udGVudCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZW5kc1dpdGhOZXdsaW5lID0gY29udGVudC5lbmRzV2l0aCgnXFxuJyk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdDb250ZW50ID0gKGVuZHNXaXRoTmV3bGluZSA/IGNvbnRlbnQgOiBgJHtjb250ZW50fVxcbmApICsgKGAkeydcXG4nLnJlcGVhdChsaW5lQnJlYWtzKX1gKSArIG1vYztcclxuICAgICAgICAgICAgICAgIHJldHVybiBuZXdDb250ZW50O1xyXG4gICAgICAgICAgICB9KS5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgaW5zZXJ0aW5nIE1PQyBsaW5rczpcIiwgZXJyKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coZXJyb3IpO1xyXG4gICAgICAgICAgICBuZXcgTm90aWNlKGBFcnJvciBpbnNlcnRpbmcgTU9DIGxpbmtzOiAke2Vycm9yLm1lc3NhZ2V9LCBDaGVjayBpZiB0aGUgTW9jIEFkbWluaXN0cmF0b3IgaXMgQ29ubmVjdGVkIHRvIHRoZSBmaWxlLmApO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG59XHJcbiIsICIvKipcclxuICogQ29uc3RhbnRlcyBkbyBwbHVnaW4gTU9DXHJcbiAqIENlbnRyYWxpemEgdmFsb3JlcyBkZSBjb25maWd1cmFcdTAwRTdcdTAwRTNvIGUgdGltZW91dHMgdXRpbGl6YWRvcyBlbSBkaWZlcmVudGVzIHBhcnRlcyBkbyBjXHUwMEYzZGlnb1xyXG4gKi9cclxuXHJcbi8vIFRpbWVvdXRzIHBhcmEgZGVib3VuY2UgZGUgZXZlbnRvcyAoZW0gbWlsaXNzZWd1bmRvcylcclxuZXhwb3J0IGNvbnN0IERFQk9VTkNFX1RJTUVPVVRTID0ge1xyXG4gICAgTU9DX0xJTktTX0FVVE9fVVBEQVRFOiAxNTAwMCwgICAgLy8gMTUgc2VndW5kb3NcclxuICAgIFVQREFURV9JTkRFWF9NT0NfVFJFRTogMTAwLCAgICAgIC8vIDEwMG1zXHJcbiAgICBGSUxFX0FVVE9fUkVOQU1JTkc6IDUwLCAgICAgICAgICAvLyA1MG1zXHJcbiAgICBTRVNTSU9OX1RJTUVPVVQ6IDUwMCwgICAgICAgICAgICAvLyA1MDBtcyBwYXJhIHNlc3NcdTAwRjVlcyBkZSByZW5hbWVcclxuICAgIENBQ0hFX1JFRlJFU0hfREVMQVk6IDIwMCwgICAgICAgIC8vIDIwMG1zIHBhcmEgYWd1YXJkYXIgYXR1YWxpemFcdTAwRTdcdTAwRTNvIGRvIGNhY2hlIGRvIE9ic2lkaWFuXHJcbn0gYXMgY29uc3Q7XHJcblxyXG4vLyBQYWRyXHUwMEY1ZXMgZGUgYXJxdWl2b3NcclxuZXhwb3J0IGNvbnN0IEZJTEVfUEFUVEVSTlMgPSB7XHJcbiAgICBNT0NfU1BBTl9TVEFSVDogJzxzcGFuIGNsYXNzPVwibW9jLXBsdWdpbi1zdGFydFwiPicsXHJcbiAgICBNT0NfU1BBTl9FTkQ6ICc8c3BhbiBjbGFzcz1cIm1vYy1wbHVnaW4tZW5kXCI+IDwvc3Bhbj4nLFxyXG4gICAgTU9DX1JFR0VYOiAvPHNwYW4gY2xhc3M9XCJtb2MtcGx1Z2luLXN0YXJ0XCI+KFtcXHNcXFNdKj8pPFxcL3NwYW4+KFtcXHNcXFNdKj8pPHNwYW4gY2xhc3M9XCJtb2MtcGx1Z2luLWVuZFwiPi8sXHJcbn0gYXMgY29uc3Q7XHJcblxyXG4vLyBDb25maWd1cmFcdTAwRTdcdTAwRjVlcyBwYWRyXHUwMEUzb1xyXG5leHBvcnQgY29uc3QgREVGQVVMVF9DT05GSUcgPSB7XHJcbiAgICBMSU5FX0JSRUFLU19ERUZBVUxUOiAxMCxcclxufSBhcyBjb25zdDtcclxuIiwgImltcG9ydCB7IEFwcCwgUGx1Z2luU2V0dGluZ1RhYiwgU2V0dGluZywgVEZpbGUsIFRGb2xkZXIgfSBmcm9tIFwib2JzaWRpYW5cIjtcclxuaW1wb3J0IE1vY1BsdWdpbiBmcm9tIFwiLi9tYWluXCI7XHJcbmltcG9ydCBNb2NBZG1pbmlzdHJhdG9yIGZyb20gXCIuL21vYy1tYW5hZ2VtZW50XCI7XHJcblxyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgREVGQVVMVF9TRVRUSU5HUyB7XHJcbiAgICBtb2NQcm9wZXJ0eUtleSA9IFwibW9jLXByb3BlcnR5XCI7XHJcbiAgICBtb2NQcm9wZXJ0eVZhbHVlID0gXCJkZWZhdWx0VmFsdWVcIjtcclxuICAgIHRlbXBsYXRlUGF0aD86IHN0cmluZyA9IHVuZGVmaW5lZDtcclxuICAgIHBhdGhFeGNlcHRpb25zOiBzdHJpbmdbXSA9IFtdO1xyXG4gICAgbW9jSGVhZGVyOiBzdHJpbmcgPSBcIk1PQyBMaW5rczpcIjtcclxuICAgIGF1dG9SZW5hbWVJbmRleEZpbGU6IGJvb2xlYW4gPSBmYWxzZTtcclxuICAgIGluZGV4RmlsZVByZWZpeDogc3RyaW5nID0gXCJJbmRleCAtIFwiO1xyXG4gICAgaW5kZXhGaWxlU3VmZml4OiBzdHJpbmcgPSBcIlwiO1xyXG4gICAgYXV0b0ZvbGRlckVtb2ppOiBzdHJpbmcgPSBcIlwiO1xyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgU2V0dGluZ3NUYWIgZXh0ZW5kcyBQbHVnaW5TZXR0aW5nVGFiIHtcclxuICAgIHBsdWdpbjogTW9jUGx1Z2luO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKGFwcDogQXBwLCBwbHVnaW46IE1vY1BsdWdpbikge1xyXG4gICAgICAgIHN1cGVyKGFwcCwgcGx1Z2luKTtcclxuICAgICAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcclxuICAgIH1cclxuXHJcbiAgICBkaXNwbGF5KCk6IHZvaWQge1xyXG4gICAgICAgIGNvbnN0IHsgY29udGFpbmVyRWwgfSA9IHRoaXM7XHJcblxyXG4gICAgICAgIGNvbnRhaW5lckVsLmVtcHR5KCk7XHJcbiAgICAgICAgLy9Nb2MgUHJvcGVydHkgS2V5XHJcbiAgICAgICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXHJcbiAgICAgICAgICAgIC5zZXROYW1lKFwiTW9jIFByb3BlcnR5IEtleVwiKVxyXG4gICAgICAgICAgICAuc2V0RGVzYyhcIlNldCB5b3VyIGRlc2lyZWQgcHJvcGVydHkga2V5IHRvIGJlIHVzZWQgaW4gTU9DIGZpbGVzXCIpXHJcbiAgICAgICAgICAgIC5hZGRUZXh0KCh0ZXh0KSA9PlxyXG4gICAgICAgICAgICAgICAgdGV4dFxyXG4gICAgICAgICAgICAgICAgICAgIC5zZXRQbGFjZWhvbGRlcihcIk1vYyBwcm9wZXJ0eSBrZXlcIilcclxuICAgICAgICAgICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MubW9jUHJvcGVydHlLZXkpXHJcbiAgICAgICAgICAgICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5tb2NQcm9wZXJ0eUtleSA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIC8vTW9jIFByb3BlcnR5IFZhbHVlXHJcbiAgICAgICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXHJcbiAgICAgICAgICAgIC5zZXROYW1lKFwiTW9jIFByb3BlcnR5IFZhbHVlXCIpXHJcbiAgICAgICAgICAgIC5zZXREZXNjKFwiU2V0IHlvdXIgZGVzaXJlZCBwcm9wZXJ0eSB2YWx1ZSAodG8gYmUgZm91bmQgaW5zaWRlIHlvdXIgcHJvcGVydHkga2V5KSB0byBiZSB1c2VkIGluIE1PQyBmaWxlc1wiKVxyXG4gICAgICAgICAgICAuYWRkVGV4dCgodGV4dCkgPT5cclxuICAgICAgICAgICAgICAgIHRleHRcclxuICAgICAgICAgICAgICAgICAgICAuc2V0UGxhY2Vob2xkZXIoXCJNb2MgcHJvcGVydHkgdmFsdWVcIilcclxuICAgICAgICAgICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MubW9jUHJvcGVydHlWYWx1ZSlcclxuICAgICAgICAgICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLm1vY1Byb3BlcnR5VmFsdWUgPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAvL1RlbXBsYXRlIFBhdGhcclxuICAgICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcclxuICAgICAgICAgICAgLnNldE5hbWUoXCJUZW1wbGF0ZSBQYXRoXCIpXHJcbiAgICAgICAgICAgIC5zZXREZXNjKFwiU2V0IHRoZSBwYXRoIHRvIHlvdXIgdGVtcGxhdGUgZmlsZSAob3B0aW9uYWwpXCIpXHJcbiAgICAgICAgICAgIC5hZGRUZXh0KCh0ZXh0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0ZXh0XHJcbiAgICAgICAgICAgICAgICAgICAgLnNldFBsYWNlaG9sZGVyKFwiVGVtcGxhdGUgcGF0aFwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MudGVtcGxhdGVQYXRoID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucGx1Z2luLnNldHRpbmdzLnRlbXBsYXRlUGF0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRleHQuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MudGVtcGxhdGVQYXRoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgY29udGFpbmVyRWwuY3JlYXRlRGl2KHsgdGV4dDogXCJFeDogcGF0aC90by95b3VyL3RlbXBsYXRlLm1kXCIsIGNsczogW1wic2V0dGluZy1pdGVtLWRlc2NyaXB0aW9uXCIsIFwic3BhY2Utc2VwYXJhdG9yXCJdIH0pO1xyXG5cclxuICAgICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcclxuICAgICAgICAgICAgLnNldE5hbWUoXCJQYXRoIEV4Y2VwdGlvbnNcIilcclxuICAgICAgICAgICAgLnNldERlc2MoXCJTZXQgcGF0aHMgdG8gYmUgaWdub3JlZCBieSB0aGUgcGx1Z2luIChzZXBhcmF0ZWQgYnkgbGluZSBicmVha3MpXCIpLmFkZFRleHRBcmVhKCh0ZXh0QXJlYSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGV4dEFyZWFcclxuICAgICAgICAgICAgICAgICAgICAuc2V0UGxhY2Vob2xkZXIoXCJQYXRoIGV4Y2VwdGlvbnNcIilcclxuICAgICAgICAgICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MucGF0aEV4Y2VwdGlvbnMuam9pbihcIlxcblwiKSlcclxuICAgICAgICAgICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnBhdGhFeGNlcHRpb25zID0gdmFsdWUuc3BsaXQoXCJcXG5cIikubWFwKChpdGVtKSA9PiBpdGVtLnRyaW0oKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy9JbmRleCBGaWxlIFByZWZpeFxyXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxyXG4gICAgICAgICAgICAuc2V0TmFtZShcIkluZGV4IEZpbGUgUHJlZml4XCIpXHJcbiAgICAgICAgICAgIC5zZXREZXNjKFwiU2V0IHRoZSBwcmVmaXggZm9yIHRoZSBpbmRleCBmaWxlIG5hbWUuXCIpXHJcbiAgICAgICAgICAgIC5hZGRUZXh0KCh0ZXh0KSA9PlxyXG4gICAgICAgICAgICAgICAgdGV4dFxyXG4gICAgICAgICAgICAgICAgICAgIC5zZXRQbGFjZWhvbGRlcihcIkluZGV4IEZpbGUgUHJlZml4XCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmluZGV4RmlsZVByZWZpeClcclxuICAgICAgICAgICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmluZGV4RmlsZVByZWZpeCA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIC8vSW5kZXggRmlsZSBTdWZmaXhcclxuICAgICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcclxuICAgICAgICAgICAgLnNldE5hbWUoXCJJbmRleCBGaWxlIFN1ZmZpeFwiKVxyXG4gICAgICAgICAgICAuc2V0RGVzYyhcIlNldCB0aGUgc3VmZml4IGZvciB0aGUgaW5kZXggZmlsZSBuYW1lLlwiKVxyXG4gICAgICAgICAgICAuYWRkVGV4dCgodGV4dCkgPT5cclxuICAgICAgICAgICAgICAgIHRleHRcclxuICAgICAgICAgICAgICAgICAgICAuc2V0UGxhY2Vob2xkZXIoXCJJbmRleCBGaWxlIFN1ZmZpeFwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5pbmRleEZpbGVTdWZmaXgpXHJcbiAgICAgICAgICAgICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5pbmRleEZpbGVTdWZmaXggPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAvL0F1dG8tRW1vamkgRm9sZGVyc1xyXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxyXG4gICAgICAgICAgICAuc2V0TmFtZShcIkF1dG8tRW1vamkgRm9sZGVyc1wiKVxyXG4gICAgICAgICAgICAuc2V0RGVzYyhcIkF1dG9tYXRpY2FsbHkgYWRkIHNwZWNpZmllZCBlbW9qaSB0byBmb2xkZXIgbmFtZXMnIHByZWZpeGVzIHdoZW4gY3JlYXRlZC5cIilcclxuICAgICAgICAgICAgLmFkZFRleHQoKHRleHQpID0+XHJcbiAgICAgICAgICAgICAgICB0ZXh0XHJcbiAgICAgICAgICAgICAgICAgICAgLnNldFBsYWNlaG9sZGVyKFwiRW50ZXIgZW1vamlcIilcclxuICAgICAgICAgICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuYXV0b0ZvbGRlckVtb2ppKVxyXG4gICAgICAgICAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuYXV0b0ZvbGRlckVtb2ppID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgLy9JbmRleCBGaWxlIEF1dG8tUmVuYW1lIGZyb20gRm9sZGVyIE5hbWVcclxuICAgICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcclxuICAgICAgICAgICAgLnNldE5hbWUoXCJJbmRleCBGaWxlIEF1dG8tUmVuYW1lIGZyb20gRm9sZGVyIE5hbWUgUmFkaWNhbFwiKVxyXG4gICAgICAgICAgICAuc2V0RGVzYyhcIkF1dG9tYXRpY2FsbHkgcmVuYW1lIHRoZSBpbmRleCBmaWxlIHRvIG1hdGNoIHRoZSBmb2xkZXIgbmFtZSB3aGVuIGNyZWF0aW5nIGEgbmV3IE1PQyBmaWxlLlwiKVxyXG4gICAgICAgICAgICAuYWRkVG9nZ2xlKCh0b2dnbGUpID0+XHJcbiAgICAgICAgICAgICAgICB0b2dnbGVcclxuICAgICAgICAgICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuYXV0b1JlbmFtZUluZGV4RmlsZSlcclxuICAgICAgICAgICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmF1dG9SZW5hbWVJbmRleEZpbGUgPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgKTtcclxuXHJcbiAgICAgICAgLy9VcGRhdGUgTW9jIFRyZWVcclxuICAgICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcclxuICAgICAgICAgICAgLnNldE5hbWUoXCJVcGRhdGUgRmlsZSBUcmVlXCIpXHJcbiAgICAgICAgICAgIC5zZXREZXNjKFwiQXV0b21hdGljYWxseSB1cGRhdGUgdGhlIEZpbGUgTW9jIHRyZWUgYW5kIGRlZmluZWQgc2V0dGluZ3Mgb24gY2xpY2suXCIpXHJcbiAgICAgICAgICAgIC5hZGRCdXR0b24oKGJ1dHRvbikgPT5cclxuICAgICAgICAgICAgICAgIGJ1dHRvblxyXG4gICAgICAgICAgICAgICAgICAgIC5zZXRCdXR0b25UZXh0KFwiVXBkYXRlXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLm9uQ2xpY2soYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBhd2FpdCB0aGlzLnBsdWdpbi51cGRhdGVNb2NUcmVlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGFueUZpbGUgPSB0aGlzLmFwcC52YXVsdC5nZXRGaWxlcygpLmZpbmQoZmlsZSA9PiBmaWxlIGluc3RhbmNlb2YgVEZpbGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtb2NBZG1pbiA9IG5ldyBNb2NBZG1pbmlzdHJhdG9yKHRoaXMucGx1Z2luLCBhbnlGaWxlIGFzIFRGaWxlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYWxsRm9sZGVycyA9IHRoaXMuYXBwLnZhdWx0LmdldEFsbEZvbGRlcnMoKS5maWx0ZXIoZmlsZSA9PiBmaWxlIGluc3RhbmNlb2YgVEZvbGRlcik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGZvbGRlciBvZiBhbGxGb2xkZXJzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5GaWxlTWFuYWdlclV0aWxzLmZvbGRlckF1dG9SZW5hbWluZyhmb2xkZXIgYXMgVEZvbGRlcik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYWxsRm9sZGVycyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtb2NBZG1pbi51cGRhdGVJbmRleE1vY1RyZWUoKTtcclxuICAgICAgICAgICAgICAgICAgICB9KSlcclxuICAgIH1cclxuXHJcbn1cclxuXHJcbiIsICJpbXBvcnQgeyBBcHAsIGRlYm91bmNlLCBOb3RpY2UsIFRBYnN0cmFjdEZpbGUsIFRGaWxlLCBURm9sZGVyIH0gZnJvbSAnb2JzaWRpYW4nO1xyXG5pbXBvcnQgTW9jUGx1Z2luIGZyb20gJy4vbWFpbic7XHJcbmltcG9ydCB7IEZpbGVNYW5hZ2VyVXRpbHMgfSBmcm9tICcuL2ZpbGUtbWFuYWdlci11dGlscyc7XHJcbmltcG9ydCBNb2NBZG1pbmlzdHJhdG9yIGZyb20gJy4vbW9jLW1hbmFnZW1lbnQnO1xyXG5pbXBvcnQgeyBERUJPVU5DRV9USU1FT1VUUyB9IGZyb20gJy4vY29uc3RhbnRzJztcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEV2ZW50SGFuZGxlcnMge1xyXG4gICAgYXBwOiBBcHA7XHJcbiAgICBwbHVnaW46IE1vY1BsdWdpbjtcclxuICAgIGZpbGVNYW5hZ2VyVXRpbHM6IEZpbGVNYW5hZ2VyVXRpbHM7XHJcbiAgICBwcml2YXRlIHBsdWdpbkluaXRpYXRlZFJlbmFtZXM6IFNldDxzdHJpbmc+ID0gbmV3IFNldCgpO1xyXG5cclxuICAgIC8vIFNlc3Npb24gdHJhY2tpbmcgcGFyYSBkaXN0aW5ndWlyIHVzZXItaW5pdGlhdGVkIHJlbmFtZXMgZGUgY2FzY2FkaW5nIHJlbmFtZSBldmVudHNcclxuICAgIC8vIFF1YW5kbyBvIHVzdVx1MDBFMXJpbyByZW5vbWVpYSB1bWEgcGFzdGEsIE9ic2lkaWFuIGRpc3BhcmEgZXZlbnRvcyBwYXJhIHRvZGFzIGFzIHN1YnBhc3RhcyBlIGFycXVpdm9zXHJcbiAgICAvLyBFc3RlIHNpc3RlbWEgcmFzdHJlaWEgYSBzZXNzXHUwMEUzbyBwYXJhIGlnbm9yYXIgZXZlbnRvcyBjYXNjYXRlYWRvcyBlIHByb2Nlc3NhciBhcGVuYXMgbyByZW5hbWUgaW5pY2lhbFxyXG4gICAgcHJpdmF0ZSB1c2VyUmVuYW1lU2Vzc2lvbjoge1xyXG4gICAgICAgIGJhc2VGb2xkZXI/OiBzdHJpbmc7ICAgICAgICAgICAvLyBDYW1pbmhvIG9yaWdpbmFsIGRhIHBhc3RhIHJlbm9tZWFkYSBwZWxvIHVzdVx1MDBFMXJpb1xyXG4gICAgICAgIHBsdWdpblJlbmFtZWRGb2xkZXI/OiBzdHJpbmc7ICAvLyBDYW1pbmhvIGFwXHUwMEYzcyBwbHVnaW4gYXBsaWNhciBhdXRvLXJlbmFtaW5nIChleDogZW1vamkgcHJlZml4KVxyXG4gICAgICAgIHRpbWVzdGFtcD86IG51bWJlcjsgICAgICAgICAgICAvLyBIb3JhIGRlIGluXHUwMEVEY2lvIGRhIHNlc3NcdTAwRTNvXHJcbiAgICAgICAgcHJvY2Vzc2VkOiBTZXQ8c3RyaW5nPjsgICAgICAgIC8vIFRvZG9zIG9zIGNhbWluaG9zIHByb2Nlc3NhZG9zIG5lc3RhIHNlc3NcdTAwRTNvXHJcbiAgICAgICAgcmVzZXRUaW1lcj86IE5vZGVKUy5UaW1lb3V0OyAgIC8vIFRpbWVyIGRlYm91bmNlZCBwYXJhIGxpbXBhciBzZXNzXHUwMEUzbyBhcFx1MDBGM3MgaW5hdGl2aWRhZGVcclxuICAgIH0gPSB7IHByb2Nlc3NlZDogbmV3IFNldCgpIH07XHJcblxyXG4gICAgY29uc3RydWN0b3IocGx1Z2luOiBNb2NQbHVnaW4pIHtcclxuICAgICAgICB0aGlzLmFwcCA9IHBsdWdpbi5hcHA7XHJcbiAgICAgICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XHJcbiAgICAgICAgdGhpcy5maWxlTWFuYWdlclV0aWxzID0gbmV3IEZpbGVNYW5hZ2VyVXRpbHMocGx1Z2luKTtcclxuICAgIH1cclxuXHJcbiAgICBhc3luYyBsb2FkRXZlbnRIYW5kbGVycygpIHtcclxuICAgICAgICAvL0RlYm91bmNlYWJsZS1OZWVkZWQgRXZlbnRzXHJcbiAgICAgICAgY29uc3QgbW9jTGlua3NBdXRvVXBkYXRlRGVib3VuY2VyID0gZGVib3VuY2UoYXN5bmMgKGFic0ZpbGU6IFRBYnN0cmFjdEZpbGUpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgbW9jQWRtaW5pc3RyYXRvciA9IG5ldyBNb2NBZG1pbmlzdHJhdG9yKHRoaXMucGx1Z2luLCBhYnNGaWxlIGFzIFRGaWxlKTtcclxuICAgICAgICAgICAgbW9jQWRtaW5pc3RyYXRvci5jb25uZWN0KCk7XHJcbiAgICAgICAgICAgIGF3YWl0IG1vY0FkbWluaXN0cmF0b3IubW9jTGlua3NBdXRvVXBkYXRlKCk7XHJcbiAgICAgICAgICAgIC8vUHJldmluZSBjaWNsb3MgdmljaW9zb3NcclxuICAgICAgICAgICAgbW9jTGlua3NBdXRvVXBkYXRlRGVib3VuY2VyLmNhbmNlbCgpO1xyXG4gICAgICAgIH0sIERFQk9VTkNFX1RJTUVPVVRTLk1PQ19MSU5LU19BVVRPX1VQREFURSwgdHJ1ZSk7XHJcblxyXG4gICAgICAgIGNvbnN0IHVwZGF0ZUluZGV4TW9jVHJlZURlYm91bmNlciA9IGRlYm91bmNlKGFzeW5jIChhYnNGaWxlOiBUQWJzdHJhY3RGaWxlKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY0FkbWluaXN0cmF0b3IgPSBuZXcgTW9jQWRtaW5pc3RyYXRvcih0aGlzLnBsdWdpbiwgYWJzRmlsZSBhcyBURmlsZSk7XHJcbiAgICAgICAgICAgIG1vY0FkbWluaXN0cmF0b3IuY29ubmVjdCgpO1xyXG4gICAgICAgICAgICBhd2FpdCBtb2NBZG1pbmlzdHJhdG9yLnVwZGF0ZUluZGV4TW9jVHJlZSgpO1xyXG4gICAgICAgIH0sIERFQk9VTkNFX1RJTUVPVVRTLlVQREFURV9JTkRFWF9NT0NfVFJFRSwgdHJ1ZSk7XHJcblxyXG4gICAgICAgIC8vIFRoaXMgY291bGQgYmUgYWx0ZXJlZCBpbiB0aGUgZnV0dXJlIGJlY2F1c2Ugb2Ygb2JzaWRpYW4gYXBpIHByb2JsZW1zXHJcbiAgICAgICAgY29uc3QgZmlsZUF1dG9SZW5hbWluZ0RlYm91bmNlciA9IGRlYm91bmNlKGFzeW5jIChhYnNGaWxlOiBUQWJzdHJhY3RGaWxlKSA9PiB7XHJcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuZmlsZU1hbmFnZXJVdGlscy5maWxlQXV0b1JlbmFtaW5nKGFic0ZpbGUgYXMgVEZpbGUpO1xyXG4gICAgICAgICAgICBmaWxlQXV0b1JlbmFtaW5nRGVib3VuY2VyLmNhbmNlbCgpO1xyXG4gICAgICAgIH0sIERFQk9VTkNFX1RJTUVPVVRTLkZJTEVfQVVUT19SRU5BTUlORywgdHJ1ZSk7XHJcblxyXG5cclxuICAgICAgICAvL0NyZWF0aW5nIGEgY2FsbCBzdGFjayBmb3IgZmFzdCByZW5hbWluZyBmaWxlc1xyXG4gICAgICAgIGxldCBwcm9taXNlU3RhY2sgPSBQcm9taXNlLnJlc29sdmUoKTtcclxuXHJcbiAgICAgICAgLy9FdmVudHNIYW5kbGVyc1xyXG4gICAgICAgIHRoaXMucGx1Z2luLnJlZ2lzdGVyRXZlbnQodGhpcy5hcHAudmF1bHQub24oXCJjcmVhdGVcIiwgKGFic0ZpbGUpID0+IHtcclxuICAgICAgICAgICAgLy9oYW5kbGUgZXhjbHVzaW9uIGNhc2VzXHJcbiAgICAgICAgICAgIGlmICh0aGlzLnBsdWdpbi5zZXR0aW5ncy5wYXRoRXhjZXB0aW9ucy5zb21lKHBhdGggPT4gYWJzRmlsZS5wYXRoLmluY2x1ZGVzKHBhdGgpKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vXHJcbiAgICAgICAgICAgIGlmIChhYnNGaWxlIGluc3RhbmNlb2YgVEZvbGRlcikge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZmlsZU5hbWVBbmRQYXRoID0gdGhpcy5maWxlTWFuYWdlclV0aWxzLmNyZWF0ZUluZGV4RmlsZU5hbWVBbmRQYXRoKGFic0ZpbGUpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5maWxlTWFuYWdlclV0aWxzLmNyZWF0ZUluZGV4RmlsZShmaWxlTmFtZUFuZFBhdGgsIFwiXCIsIHRoaXMucGx1Z2luLnNldHRpbmdzLm1vY1Byb3BlcnR5S2V5LCB0aGlzLnBsdWdpbi5zZXR0aW5ncy5tb2NQcm9wZXJ0eVZhbHVlLCB0aGlzLnBsdWdpbi5zZXR0aW5ncy50ZW1wbGF0ZVBhdGgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSkpO1xyXG5cclxuICAgICAgICB0aGlzLnBsdWdpbi5yZWdpc3RlckV2ZW50KHRoaXMuYXBwLnZhdWx0Lm9uKFwicmVuYW1lXCIsIGFzeW5jIChhYnNGaWxlLCBvbGRQYXRoKSA9PiB7XHJcbiAgICAgICAgICAgIC8vaGFuZGxlIGV4Y2x1c2lvbiBjYXNlc1xyXG4gICAgICAgICAgICBpZiAodGhpcy5wbHVnaW4uc2V0dGluZ3MucGF0aEV4Y2VwdGlvbnMuc29tZShwYXRoID0+IGFic0ZpbGUucGF0aC5pbmNsdWRlcyhwYXRoKSkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gQ2hlY2sgaWYgdGhpcyByZW5hbWUgd2FzIGluaXRpYXRlZCBieSBvdXIgcGx1Z2luXHJcbiAgICAgICAgICAgIGlmICh0aGlzLnBsdWdpbkluaXRpYXRlZFJlbmFtZXMuaGFzKG9sZFBhdGgpKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBJZiB0aGlzIGlzIGEgZm9sZGVyIHJlbmFtZSBieSBvdXIgcGx1Z2luLCB1cGRhdGUgdGhlIHNlc3Npb24gdG8gdHJhY2sgdGhlIG5ldyBwYXRoXHJcbiAgICAgICAgICAgICAgICBpZiAoYWJzRmlsZSBpbnN0YW5jZW9mIFRGb2xkZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBDaGVjayBpZiB0aGlzIGZvbGRlciBpcyBwYXJ0IG9mIHRoZSBjdXJyZW50IHNlc3Npb25cclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBub3JtYWxpemVkT2xkUGF0aCA9IG9sZFBhdGgucmVwbGFjZSgvXlxcLyt8XFwvKyQvZywgJycpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG5vcm1hbGl6ZWRCYXNlUGF0aCA9IHRoaXMudXNlclJlbmFtZVNlc3Npb24uYmFzZUZvbGRlcj8ucmVwbGFjZSgvXlxcLyt8XFwvKyQvZywgJycpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgc2Vzc2lvbiBpZiB0aGlzIG1hdGNoZXMgdGhlIGJhc2UgZm9sZGVyIG9yIHdhcyBwcm9jZXNzZWQgaW4gdGhlIGN1cnJlbnQgc2Vzc2lvblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChub3JtYWxpemVkT2xkUGF0aCA9PT0gbm9ybWFsaXplZEJhc2VQYXRoIHx8XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudXNlclJlbmFtZVNlc3Npb24ucHJvY2Vzc2VkLmhhcyhvbGRQYXRoKSB8fFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVzZXJSZW5hbWVTZXNzaW9uLnByb2Nlc3NlZC5oYXMobm9ybWFsaXplZE9sZFBhdGgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudXNlclJlbmFtZVNlc3Npb24ucGx1Z2luUmVuYW1lZEZvbGRlciA9IGFic0ZpbGUucGF0aDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXNldFNlc3Npb25UaW1lcigpOyAvLyBSZXNldCB0aW1lciB0byBrZWVwIHNlc3Npb24gYWxpdmVcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gQWxsb3cgcGx1Z2luLWdlbmVyYXRlZCByZW5hbWVzIGZyb20gaW5kZXggZmlsZXMgdG8gcGFzcyB0aHJvdWdoIGZvciBhdXRvLXJlbmFtaW5nXHJcbiAgICAgICAgICAgICAgICBpZiAoYWJzRmlsZSBpbnN0YW5jZW9mIFRGaWxlICYmIHRoaXMuZmlsZU1hbmFnZXJVdGlscy5pc0luZGV4RmlsZShhYnNGaWxlKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHByb21pc2VTdGFjayA9IHByb21pc2VTdGFjay50aGVuKGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5maWxlTWFuYWdlclV0aWxzLmZpbGVBdXRvUmVuYW1pbmcoYWJzRmlsZSBhcyBURmlsZSwgKG9sZFBhdGgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luSW5pdGlhdGVkUmVuYW1lcy5hZGQob2xkUGF0aCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luSW5pdGlhdGVkUmVuYW1lcy5kZWxldGUob2xkUGF0aCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIERldGVjdCBpZiB0aGlzIGlzIHRoZSBzdGFydCBvZiBhIG5ldyB1c2VyIHJlbmFtZSBzZXNzaW9uIG9yIHBhcnQgb2YgY2FzY2FkaW5nIGV2ZW50c1xyXG4gICAgICAgICAgICBjb25zdCBpc05ld1JlbmFtZVNlc3Npb24gPSB0aGlzLmRldGVjdE5ld1JlbmFtZVNlc3Npb24oYWJzRmlsZSwgb2xkUGF0aCk7XHJcblxyXG4gICAgICAgICAgICBpZiAoaXNOZXdSZW5hbWVTZXNzaW9uKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXJ0TmV3UmVuYW1lU2Vzc2lvbihhYnNGaWxlLCBvbGRQYXRoKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmlzUGFydE9mQ3VycmVudFJlbmFtZVNlc3Npb24oYWJzRmlsZSwgb2xkUGF0aCkpIHtcclxuICAgICAgICAgICAgICAgIC8vIFRoaXMgaXMgYSBjYXNjYWRpbmcgcmVuYW1lLCBpZ25vcmUgaXRcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gTWFyayB0aGlzIHBhdGggYXMgcHJvY2Vzc2VkIGluIGN1cnJlbnQgc2Vzc2lvbiBhbmQgcmVzZXQgdGhlIHRpbWVyXHJcbiAgICAgICAgICAgIHRoaXMudXNlclJlbmFtZVNlc3Npb24ucHJvY2Vzc2VkLmFkZChvbGRQYXRoKTtcclxuXHJcbiAgICAgICAgICAgIC8vIEFsc28gbWFyayB0aGUgbmV3IHBhdGggYXMgcHJvY2Vzc2VkIHRvIHRyYWNrIHRoZSByZW5hbWUgY2hhaW5cclxuICAgICAgICAgICAgaWYgKGFic0ZpbGUucGF0aCAhPT0gb2xkUGF0aCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy51c2VyUmVuYW1lU2Vzc2lvbi5wcm9jZXNzZWQuYWRkKGFic0ZpbGUucGF0aCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRoaXMucmVzZXRTZXNzaW9uVGltZXIoKTtcclxuXHJcbiAgICAgICAgICAgIHByb21pc2VTdGFjayA9IHByb21pc2VTdGFjay50aGVuKGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgICAgIHVwZGF0ZUluZGV4TW9jVHJlZURlYm91bmNlcihhYnNGaWxlKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgLy8gUGFyYSBtb3ZlciBhcnF1aXZvc1xyXG4gICAgICAgICAgICAgICAgaWYgKGFic0ZpbGUubmFtZSA9PT0gb2xkUGF0aC5zcGxpdChcIi9cIikucG9wKCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBQYXJhIEluZGV4IE1vYyBGaWxlcyBxdWUgZm9yYW0gbW92aWRvcyAoblx1MDBFM28gcmVub21lYWRvcyk6IGF0dWFsaXphciBmaWxlbmFtZSBwYXJhIGNvcnJlc3BvbmRlciBub3ZhIHBhc3RhIHBhaVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChhYnNGaWxlIGluc3RhbmNlb2YgVEZpbGUgJiYgdGhpcy5maWxlTWFuYWdlclV0aWxzLmlzSW5kZXhGaWxlKGFic0ZpbGUpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb21pc2VTdGFjayA9IHByb21pc2VTdGFjay50aGVuKGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuZmlsZU1hbmFnZXJVdGlscy5maWxlQXV0b1JlbmFtaW5nKGFic0ZpbGUgYXMgVEZpbGUsIChvbGRQYXRoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW5Jbml0aWF0ZWRSZW5hbWVzLmFkZChvbGRQYXRoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvLyBQYXJhIHJlbm9tZWFyIGFycXVpdm9zL3Bhc3Rhc1xyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gTGlkYXIgY29tIHJlbm9tZWFcdTAwRTdcdTAwRTNvIGRlIHBhc3RhIHByaW1laXJvXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucGx1Z2luLnNldHRpbmdzLmF1dG9Gb2xkZXJFbW9qaSAhPT0gXCJcIiAmJiBhYnNGaWxlIGluc3RhbmNlb2YgVEZvbGRlcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9taXNlU3RhY2sgPSBwcm9taXNlU3RhY2sudGhlbihhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmZpbGVNYW5hZ2VyVXRpbHMuZm9sZGVyQXV0b1JlbmFtaW5nKGFic0ZpbGUsIChvbGRQYXRoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW5Jbml0aWF0ZWRSZW5hbWVzLmFkZChvbGRQYXRoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFndWFyZGFyIE9ic2lkaWFuIGF0dWFsaXphciBjYWNoZSBkZSBhcnF1aXZvcyBhcFx1MDBGM3MgcmVuYW1lIGRhIHBhc3RhXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgREVCT1VOQ0VfVElNRU9VVFMuQ0FDSEVfUkVGUkVTSF9ERUxBWSkpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEF0dWFsaXphciBpbmRleCBmaWxlcyBuYSBwYXN0YSByZW5vbWVhZGFcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGZpbGVzSW5Gb2xkZXIgPSB0aGlzLmFwcC52YXVsdC5nZXRNYXJrZG93bkZpbGVzKCkuZmlsdGVyKGZpbGUgPT5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlLnBhdGguc3RhcnRzV2l0aChhYnNGaWxlLnBhdGggKyBcIi9cIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5kZXhGaWxlcyA9IGZpbGVzSW5Gb2xkZXIuZmlsdGVyKGZpbGUgPT5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZpbGVNYW5hZ2VyVXRpbHMuaXNJbmRleEZpbGUoZmlsZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gUHJvY2Vzc2FyIGluZGV4IGZpbGVzIHNlcXVlbmNpYWxtZW50ZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBpbmRleEZpbGUgb2YgaW5kZXhGaWxlcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuZmlsZU1hbmFnZXJVdGlscy5maWxlQXV0b1JlbmFtaW5nKGluZGV4RmlsZSwgKG9sZFBhdGgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW5Jbml0aWF0ZWRSZW5hbWVzLmFkZChvbGRQYXRoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIC8vIFNlIFx1MDBFOSB1bSBpbmRleCBmaWxlIHNlbmRvIHJlbm9tZWFkbyBkaXJldGFtZW50ZSAoblx1MDBFM28gY29tbyBwYXJ0ZSBkZSBmb2xkZXIgcmVuYW1lKVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGFic0ZpbGUgaW5zdGFuY2VvZiBURmlsZSAmJiB0aGlzLmZpbGVNYW5hZ2VyVXRpbHMuaXNJbmRleEZpbGUoYWJzRmlsZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcHJvbWlzZVN0YWNrID0gcHJvbWlzZVN0YWNrLnRoZW4oYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5maWxlTWFuYWdlclV0aWxzLmZpbGVBdXRvUmVuYW1pbmcoYWJzRmlsZSBhcyBURmlsZSwgKG9sZFBhdGgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbkluaXRpYXRlZFJlbmFtZXMuYWRkKG9sZFBhdGgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEVycm9yIGhhbmRsaW5nIHJlbmFtZSBmcm9tICR7b2xkUGF0aH0gdG8gJHthYnNGaWxlLnBhdGh9OmAsIGVycm9yKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pKTtcclxuXHJcbiAgICAgICAgdGhpcy5wbHVnaW4ucmVnaXN0ZXJFdmVudCh0aGlzLmFwcC52YXVsdC5vbihcIm1vZGlmeVwiLCAoYWJzRmlsZSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5wbHVnaW4uc2V0dGluZ3MucGF0aEV4Y2VwdGlvbnMuc29tZShwYXRoID0+IGFic0ZpbGUucGF0aC5pbmNsdWRlcyhwYXRoKSkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBtb2NMaW5rc0F1dG9VcGRhdGVEZWJvdW5jZXIoYWJzRmlsZSlcclxuICAgICAgICAgICAgdXBkYXRlSW5kZXhNb2NUcmVlRGVib3VuY2VyKGFic0ZpbGUpO1xyXG4gICAgICAgIH0pKTtcclxuXHJcbiAgICAgICAgdGhpcy5wbHVnaW4ucmVnaXN0ZXJFdmVudCh0aGlzLmFwcC52YXVsdC5vbihcImRlbGV0ZVwiLCBhc3luYyAoYWJzRmlsZSkgPT4ge1xyXG4gICAgICAgICAgICAvL2hhbmRsZSBleGNsdXNpb24gY2FzZXNcclxuICAgICAgICAgICAgaWYgKHRoaXMucGx1Z2luLnNldHRpbmdzLnBhdGhFeGNlcHRpb25zLnNvbWUocGF0aCA9PiBhYnNGaWxlLnBhdGguaW5jbHVkZXMocGF0aCkpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdXBkYXRlSW5kZXhNb2NUcmVlRGVib3VuY2VyKGFic0ZpbGUpO1xyXG5cclxuICAgICAgICB9KSk7XHJcblxyXG4gICAgfVxyXG5cclxuXHJcbiAgICAvKipcclxuICAgICAqIEluaWNpYSB1bWEgbm92YSBzZXNzXHUwMEUzbyBkZSByZW5hbWUgY29tIHRpbWVyIGRlYm91bmNlZFxyXG4gICAgICogSXNzbyByYXN0cmVpYSBvIHJlbmFtZSBpbmljaWFsIGluaWNpYWRvIHBlbG8gdXN1XHUwMEUxcmlvIHBhcmEgZGlzdGluZ3VpLWxvIGRlIGV2ZW50b3MgY2FzY2F0ZWFkb3NcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBzdGFydE5ld1JlbmFtZVNlc3Npb24oYWJzRmlsZTogVEFic3RyYWN0RmlsZSwgb2xkUGF0aDogc3RyaW5nKTogdm9pZCB7XHJcbiAgICAgICAgLy8gTGltcGFyIHRpbWVyIGV4aXN0ZW50ZSBzZSBob3V2ZXJcclxuICAgICAgICBpZiAodGhpcy51c2VyUmVuYW1lU2Vzc2lvbi5yZXNldFRpbWVyKSB7XHJcbiAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLnVzZXJSZW5hbWVTZXNzaW9uLnJlc2V0VGltZXIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy51c2VyUmVuYW1lU2Vzc2lvbi5iYXNlRm9sZGVyID0gdGhpcy5maWxlTWFuYWdlclV0aWxzLmdldEJhc2VGb2xkZXJQYXRoKGFic0ZpbGUsIG9sZFBhdGgpO1xyXG4gICAgICAgIHRoaXMudXNlclJlbmFtZVNlc3Npb24udGltZXN0YW1wID0gRGF0ZS5ub3coKTtcclxuICAgICAgICB0aGlzLnVzZXJSZW5hbWVTZXNzaW9uLnByb2Nlc3NlZC5jbGVhcigpO1xyXG5cclxuICAgICAgICAvLyBJbmljaWFyIG8gdGltZXIgZGUgdGltZW91dCBkYSBzZXNzXHUwMEUzb1xyXG4gICAgICAgIHRoaXMucmVzZXRTZXNzaW9uVGltZXIoKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFJlc2V0YSBvIHRpbWVyIGRhIHNlc3NcdTAwRTNvIChkZWJvdW5jZWQpXHJcbiAgICAgKiBFc3RlbmRlIGEgc2Vzc1x1MDBFM28gcXVhbmRvIG5vdm9zIGV2ZW50b3MgZGUgcmVuYW1lIHNcdTAwRTNvIGRldGVjdGFkb3MgY29tbyBwYXJ0ZSBkYSBtZXNtYSBvcGVyYVx1MDBFN1x1MDBFM29cclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSByZXNldFNlc3Npb25UaW1lcigpOiB2b2lkIHtcclxuICAgICAgICAvLyBMaW1wYXIgdGltZXIgZXhpc3RlbnRlXHJcbiAgICAgICAgaWYgKHRoaXMudXNlclJlbmFtZVNlc3Npb24ucmVzZXRUaW1lcikge1xyXG4gICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy51c2VyUmVuYW1lU2Vzc2lvbi5yZXNldFRpbWVyKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIERlZmluaXIgbm92byB0aW1lciBwYXJhIGxpbXBhciBzZXNzXHUwMEUzbyBhcFx1MDBGM3MgdGltZW91dFxyXG4gICAgICAgIHRoaXMudXNlclJlbmFtZVNlc3Npb24ucmVzZXRUaW1lciA9IHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmNsZWFyUmVuYW1lU2Vzc2lvbigpO1xyXG4gICAgICAgIH0sIERFQk9VTkNFX1RJTUVPVVRTLlNFU1NJT05fVElNRU9VVCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBDbGVhcnMgdGhlIGN1cnJlbnQgcmVuYW1lIHNlc3Npb25cclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBjbGVhclJlbmFtZVNlc3Npb24oKTogdm9pZCB7XHJcbiAgICAgICAgaWYgKHRoaXMudXNlclJlbmFtZVNlc3Npb24ucmVzZXRUaW1lcikge1xyXG4gICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy51c2VyUmVuYW1lU2Vzc2lvbi5yZXNldFRpbWVyKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMudXNlclJlbmFtZVNlc3Npb24uYmFzZUZvbGRlciA9IHVuZGVmaW5lZDtcclxuICAgICAgICB0aGlzLnVzZXJSZW5hbWVTZXNzaW9uLnBsdWdpblJlbmFtZWRGb2xkZXIgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgdGhpcy51c2VyUmVuYW1lU2Vzc2lvbi50aW1lc3RhbXAgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgdGhpcy51c2VyUmVuYW1lU2Vzc2lvbi5wcm9jZXNzZWQuY2xlYXIoKTtcclxuICAgICAgICB0aGlzLnVzZXJSZW5hbWVTZXNzaW9uLnJlc2V0VGltZXIgPSB1bmRlZmluZWQ7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBEZXRlY3RhIHNlIGVzdGUgXHUwMEU5IG8gaW5cdTAwRURjaW8gZGUgdW1hIG5vdmEgc2Vzc1x1MDBFM28gZGUgcmVuYW1lIGRvIHVzdVx1MDBFMXJpb1xyXG4gICAgICogUmV0b3JuYSB0cnVlIHBhcmEgcmVuYW1lcyBnZW51XHUwMEVEbm9zIGluaWNpYWRvcyBwZWxvIHVzdVx1MDBFMXJpbywgZmFsc2UgcGFyYSBldmVudG9zIGNhc2NhdGVhZG9zXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgZGV0ZWN0TmV3UmVuYW1lU2Vzc2lvbihhYnNGaWxlOiBUQWJzdHJhY3RGaWxlLCBvbGRQYXRoOiBzdHJpbmcpOiBib29sZWFuIHtcclxuICAgICAgICAvLyBTZSBuXHUwMEUzbyBoXHUwMEUxIHNlc3NcdTAwRTNvIGF0aXZhLCBlc3RhIFx1MDBFOSB1bWEgbm92YSBzZXNzXHUwMEUzb1xyXG4gICAgICAgIGlmICghdGhpcy51c2VyUmVuYW1lU2Vzc2lvbi50aW1lc3RhbXAgfHwgIXRoaXMudXNlclJlbmFtZVNlc3Npb24uYmFzZUZvbGRlcikge1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFNlIGVzdGUgY2FtaW5obyBuXHUwMEUzbyBmb2kgcHJvY2Vzc2FkbyBhaW5kYSBlIG5cdTAwRTNvIFx1MDBFOSBmaWxobyBkYSBwYXN0YSBiYXNlXHJcbiAgICAgICAgY29uc3Qgd2FzUHJvY2Vzc2VkID0gdGhpcy51c2VyUmVuYW1lU2Vzc2lvbi5wcm9jZXNzZWQuaGFzKG9sZFBhdGgpO1xyXG4gICAgICAgIGNvbnN0IGlzQ2hpbGQgPSB0aGlzLmlzQ2hpbGRPZkJhc2VGb2xkZXIob2xkUGF0aCk7XHJcblxyXG4gICAgICAgIC8vIE5vdmEgc2Vzc1x1MDBFM28gc2UgY2FtaW5obyBuXHUwMEUzbyBwcm9jZXNzYWRvIGUgblx1MDBFM28gXHUwMEU5IGZpbGhvIGRhIHBhc3RhIGJhc2VcclxuICAgICAgICByZXR1cm4gIXdhc1Byb2Nlc3NlZCAmJiAhaXNDaGlsZDtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIENoZWNrcyBpZiB0aGlzIHJlbmFtZSBpcyBwYXJ0IG9mIHRoZSBjdXJyZW50IHJlbmFtZSBzZXNzaW9uIChjYXNjYWRpbmcgZWZmZWN0KVxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIGlzUGFydE9mQ3VycmVudFJlbmFtZVNlc3Npb24oYWJzRmlsZTogVEFic3RyYWN0RmlsZSwgb2xkUGF0aDogc3RyaW5nKTogYm9vbGVhbiB7XHJcbiAgICAgICAgLy8gSWYgbm8gYWN0aXZlIHNlc3Npb24sIG5vdCBwYXJ0IG9mIGN1cnJlbnQgc2Vzc2lvblxyXG4gICAgICAgIGlmICghdGhpcy51c2VyUmVuYW1lU2Vzc2lvbi50aW1lc3RhbXAgfHwgIXRoaXMudXNlclJlbmFtZVNlc3Npb24uYmFzZUZvbGRlcikge1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBJZiB0aGlzIGlzIGEgY2hpbGQgb2YgdGhlIGJhc2UgZm9sZGVyIGJlaW5nIHJlbmFtZWQsIGl0J3MgcGFydCBvZiB0aGUgc2Vzc2lvblxyXG4gICAgICAgIHJldHVybiB0aGlzLmlzQ2hpbGRPZkJhc2VGb2xkZXIob2xkUGF0aCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBWZXJpZmljYSBzZSB1bSBjYW1pbmhvIFx1MDBFOSBmaWxobyBkYSBwYXN0YSBiYXNlIGF0dWFsIHNlbmRvIHJlbm9tZWFkYVxyXG4gICAgICogSXNzbyBpbmNsdWkgdmVyaWZpY2FyIGNvbnRyYTpcclxuICAgICAqIC0gQ2FtaW5obyBkYSBwYXN0YSBiYXNlIG9yaWdpbmFsXHJcbiAgICAgKiAtIENhbWluaG8gZGEgcGFzdGEgcGx1Z2luLXJlbmFtZWQgKGFwXHUwMEYzcyBlbW9qaSBwcmVmaXggc2VyIGFkaWNpb25hZG8pXHJcbiAgICAgKiAtIFF1YWlzcXVlciBjYW1pbmhvcyBpbnRlcm1lZGlcdTAwRTFyaW9zIHByb2Nlc3NhZG9zIGR1cmFudGUgYSBjYWRlaWEgZGUgcmVuYW1lXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgaXNDaGlsZE9mQmFzZUZvbGRlcihwYXRoOiBzdHJpbmcpOiBib29sZWFuIHtcclxuICAgICAgICBpZiAoIXRoaXMudXNlclJlbmFtZVNlc3Npb24uYmFzZUZvbGRlcikge1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBWZXJpZmljYXIgY29udHJhIHBhc3RhIGJhc2Ugb3JpZ2luYWxcclxuICAgICAgICBpZiAodGhpcy5maWxlTWFuYWdlclV0aWxzLmlzQ2hpbGRPZlBhdGgocGF0aCwgdGhpcy51c2VyUmVuYW1lU2Vzc2lvbi5iYXNlRm9sZGVyKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFZlcmlmaWNhciBjb250cmEgcGFzdGEgcGx1Z2luLXJlbmFtZWQgc2UgZXhpc3RpclxyXG4gICAgICAgIGlmICh0aGlzLnVzZXJSZW5hbWVTZXNzaW9uLnBsdWdpblJlbmFtZWRGb2xkZXIpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuZmlsZU1hbmFnZXJVdGlscy5pc0NoaWxkT2ZQYXRoKHBhdGgsIHRoaXMudXNlclJlbmFtZVNlc3Npb24ucGx1Z2luUmVuYW1lZEZvbGRlcikpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBWZXJpZmljYXIgc2UgZXN0ZSBjYW1pbmhvIFx1MDBFOSBmaWxobyBkZSBhbGd1bWEgcGFzdGEgcHJvY2Vzc2FkYSBuYSBzZXNzXHUwMEUzb1xyXG4gICAgICAgIGZvciAoY29uc3QgcHJvY2Vzc2VkUGF0aCBvZiB0aGlzLnVzZXJSZW5hbWVTZXNzaW9uLnByb2Nlc3NlZCkge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5maWxlTWFuYWdlclV0aWxzLmlzQ2hpbGRPZlBhdGgocGF0aCwgcHJvY2Vzc2VkUGF0aCkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbn0iXSwKICAibWFwcGluZ3MiOiAiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsSUFBQUEsbUJBSU87OztBQ0pQLElBQUFDLG1CQUEyRDs7O0FDQTNELHNCQUE0Qzs7O0FDTXJDLElBQU0sb0JBQW9CO0FBQUEsRUFDN0IsdUJBQXVCO0FBQUE7QUFBQSxFQUN2Qix1QkFBdUI7QUFBQTtBQUFBLEVBQ3ZCLG9CQUFvQjtBQUFBO0FBQUEsRUFDcEIsaUJBQWlCO0FBQUE7QUFBQSxFQUNqQixxQkFBcUI7QUFBQTtBQUN6QjtBQUdPLElBQU0sZ0JBQWdCO0FBQUEsRUFDekIsZ0JBQWdCO0FBQUEsRUFDaEIsY0FBYztBQUFBLEVBQ2QsV0FBVztBQUNmO0FBR08sSUFBTSxpQkFBaUI7QUFBQSxFQUMxQixxQkFBcUI7QUFDekI7OztBRG5CQSxJQUFxQixtQkFBckIsTUFBc0M7QUFBQSxFQVlsQyxZQUFZLGdCQUEyQixXQUFrQjtBQUNyRCxTQUFLLE1BQU0sZUFBZTtBQUMxQixTQUFLLFNBQVM7QUFDZCxTQUFLLFlBQVk7QUFDakIsU0FBSyxXQUFXLGVBQWU7QUFDL0IsU0FBSyxjQUFjLElBQUksaUJBQWlCLGNBQWM7QUFBQSxFQUMxRDtBQUFBLEVBRUEsVUFBVTtBQUdOLFNBQUssV0FBVyxLQUFLLHVCQUF1QjtBQUFBLEVBRWhEO0FBQUEsRUFFQSxNQUFNLGdCQUFnQixhQUFzQixNQUFxQjtBQUM3RCxRQUFJO0FBQ0osUUFBSSxZQUFZO0FBQ1osaUJBQVc7QUFBQSxJQUNmLE9BQ0s7QUFDRCxpQkFBVztBQUFBLElBQ2Y7QUFDQSxRQUFJO0FBQ0EsV0FBSyxJQUFJLE1BQU0sUUFBUSxLQUFLLFdBQVcsQ0FBQyxZQUFZO0FBQ2hELGVBQU8sUUFBUSxRQUFRLFVBQVUsRUFBRTtBQUFBLE1BQ3ZDLENBQUMsRUFBRSxNQUFNLENBQUMsUUFBUTtBQUNkLGdCQUFRLE1BQU0sOEJBQThCLEdBQUc7QUFBQSxNQUNuRCxDQUFDO0FBQUEsSUFDTCxTQUFTLEtBQVA7QUFDRSxjQUFRLElBQUksR0FBRztBQUFBLElBQ25CO0FBQUEsRUFDSjtBQUFBLEVBRUEseUJBQStDO0FBQzNDLFVBQU0sV0FBaUM7QUFBQSxNQUNuQyxRQUFRLEtBQUssY0FBYztBQUFBLE1BQzNCLFVBQVUsS0FBSyxpQkFBaUI7QUFBQSxNQUNoQyxPQUFPLEtBQUssY0FBYztBQUFBLElBQzlCO0FBQ0EsV0FBTztBQUFBLEVBQ1g7QUFBQSxFQUVBLE1BQU0saUJBQWlCO0FBQ25CLFVBQU0sS0FBSyxnQkFBZ0IsS0FBSztBQUNoQyxVQUFNLEtBQUssa0JBQWtCLENBQUM7QUFBQSxFQUNsQztBQUFBLEVBRUEsTUFBTSxxQkFBb0M7QUFDdEMsUUFBSSxLQUFLLFlBQVksWUFBWSxLQUFLLFNBQVMsR0FBRztBQUU5QyxZQUFNLGFBQWEsTUFBTSxLQUFLLElBQUksTUFBTSxRQUFRLE9BQU8sS0FBSyxVQUFVLElBQUk7QUFDMUUsVUFBSSxDQUFDLFlBQVk7QUFDYixnQkFBUSxLQUFLLFFBQVEsS0FBSyxVQUFVLDRDQUE0QztBQUNoRjtBQUFBLE1BQ0o7QUFFQSxVQUFJO0FBQ0EsY0FBTSxtQkFBbUIsSUFBSSxpQkFBaUIsS0FBSyxRQUFRLEtBQUssU0FBa0I7QUFDbEYseUJBQWlCLFFBQVE7QUFDekIsY0FBTSxpQkFBaUIsZUFBZTtBQUFBLE1BQzFDLFNBQVMsT0FBUDtBQUNFLGdCQUFRLE1BQU0sMEJBQTBCLEtBQUssVUFBVSxTQUFTLEtBQUs7QUFBQSxNQUN6RTtBQUFBLElBQ0o7QUFBQSxFQUNKO0FBQUEsRUFFQSxNQUFNLHFCQUFvQztBQUN0QyxVQUFNLFFBQVEsS0FBSyxJQUFJLE1BQU0saUJBQWlCLEVBQUUsT0FBTyxVQUFRLEtBQUssWUFBWSxZQUFZLElBQUksQ0FBQztBQUVqRyxlQUFXLFFBQVEsT0FBTztBQUV0QixZQUFNLGFBQWEsTUFBTSxLQUFLLElBQUksTUFBTSxRQUFRLE9BQU8sS0FBSyxJQUFJO0FBQ2hFLFVBQUksWUFBWTtBQUNaLGNBQU0sbUJBQW1CLElBQUksaUJBQWlCLEtBQUssUUFBUSxJQUFJO0FBQy9ELHlCQUFpQixRQUFRO0FBQ3pCLGNBQU0saUJBQWlCLGVBQWU7QUFBQSxNQUMxQyxPQUFPO0FBQ0gsZ0JBQVEsS0FBSyxRQUFRLEtBQUssdURBQXVEO0FBQUEsTUFDckY7QUFBQSxJQUNKO0FBQUEsRUFDSjtBQUFBO0FBQUEsRUFNQSxjQUFjLFlBQVksS0FBSyxXQUF1QztBQUNsRSxRQUFJLFdBQXVDO0FBRTNDLFFBQUksQ0FBQyxVQUFVLFFBQVE7QUFFbkIsaUJBQVcsS0FBSyxJQUFJLE1BQU0sUUFBUSxFQUFFLFNBQVMsT0FBTyxDQUFDLFlBQVksbUJBQW1CLHlCQUFTLFFBQVEsU0FBUyxVQUFVLElBQUk7QUFBQSxJQUNoSSxPQUNLO0FBRUQsaUJBQVcsVUFBVSxPQUFPLFNBQVMsT0FBTyxDQUFDLFlBQVksbUJBQW1CLHlCQUFTLFFBQVEsU0FBUyxVQUFVLElBQUk7QUFBQSxJQUN4SDtBQUNBLFFBQUksQ0FBQyxZQUFZLFNBQVMsV0FBVyxHQUFHO0FBQ3BDLGFBQU87QUFBQSxJQUNYO0FBRUEsV0FBTztBQUFBLEVBQ1g7QUFBQSxFQUVBLGNBQWMsWUFBWSxLQUFLLFdBQVc7QUFDdEMsUUFBSSxlQUFlLFVBQVU7QUFDN0IsUUFBSSxDQUFDLGNBQWM7QUFDZixhQUFPO0FBQUEsSUFDWDtBQUNBLG1CQUFlLGFBQWE7QUFDNUIsV0FBTyxjQUFjO0FBRWpCLFlBQU0scUJBQThCLGFBQWEsU0FBUyxPQUFPLENBQUMsVUFBVTtBQWxJeEY7QUFtSWdCLFlBQUksaUJBQWlCLHVCQUFPO0FBQ3hCLGdCQUFNLG1CQUFrQixVQUFLLElBQUksY0FBYyxhQUFhLEtBQUssTUFBekMsbUJBQTRDO0FBRXBFLGNBQUksbUJBQW1CLGdCQUFnQixLQUFLLFNBQVMsY0FBYyxNQUFNLEtBQUssU0FBUyxrQkFBa0I7QUFDckcsbUJBQU87QUFBQSxVQUNYO0FBQUEsUUFDSjtBQUFBLE1BQ0osQ0FBQztBQUNELFVBQUksbUJBQW1CLFdBQVcsR0FBRztBQUNqQyxlQUFPLG1CQUFtQixDQUFDO0FBQUEsTUFDL0IsV0FDUyxtQkFBbUIsU0FBUyxHQUFHO0FBR3BDLGVBQU8sbUJBQW1CLENBQUM7QUFBQSxNQUMvQjtBQUNBLHFCQUFlLGFBQWE7QUFBQSxJQUNoQztBQUVBLFdBQU87QUFBQSxFQUNYO0FBQUEsRUFHQSxpQkFBaUIsWUFBWSxLQUFLLFdBQVc7QUFDekMsVUFBTSxlQUFlLEtBQUssWUFBWSxnQkFBZ0IsU0FBUztBQUMvRCxRQUFJLGdCQUF5QixDQUFDO0FBQzlCLFVBQU0sMEJBQTBCLENBQUMsbUJBQTRCO0FBQ3pELFVBQUksd0JBQW1DLENBQUM7QUFDeEMsVUFBSSxzQkFBK0IsQ0FBQztBQUNwQyxxQkFBZSxTQUFTLFFBQVEsQ0FBQyxVQUFVO0FBaEt2RDtBQWlLZ0IsWUFBSSxpQkFBaUIsdUJBQU87QUFDeEIsZ0JBQU0sbUJBQWtCLFVBQUssSUFBSSxjQUFjLGFBQWEsS0FBSyxNQUF6QyxtQkFBNEM7QUFDcEUsY0FBSSxtQkFBbUIsZ0JBQWdCLEtBQUssU0FBUyxjQUFjLE1BQU0sS0FBSyxTQUFTLGtCQUFrQjtBQUNyRyxnQ0FBb0IsS0FBSyxLQUFLO0FBQUEsVUFDbEM7QUFBQSxRQUNKLFdBQ1MsaUJBQWlCLHlCQUFTO0FBQy9CLGdDQUFzQixLQUFLLEtBQUs7QUFBQSxRQUNwQztBQUFBLE1BQ0osQ0FBQztBQUNELFVBQUksb0JBQW9CLFdBQVcsR0FBRztBQUNsQyw4QkFBc0IsUUFBUSxDQUFDLFdBQVc7QUFDdEMsa0NBQXdCLE1BQU07QUFBQSxRQUNsQyxDQUFDO0FBQUEsTUFDTDtBQUNBLFVBQUksb0JBQW9CLFNBQVMsR0FBRztBQUFBLE1BRXBDO0FBRUEsc0JBQWdCLENBQUMsR0FBRyxlQUFlLEdBQUcsbUJBQW1CO0FBQUEsSUFDN0Q7QUFDQSxpQkFBYSxTQUFTLFFBQVEsQ0FBQyxVQUFVO0FBQ3JDLFVBQUksaUJBQWlCLHlCQUFTO0FBQzFCLGdDQUF3QixLQUFLO0FBQUEsTUFDakM7QUFBQSxJQUNKLENBQUM7QUFFRCxRQUFJLGNBQWMsV0FBVyxHQUFHO0FBRTVCLGFBQU87QUFBQSxJQUNYO0FBRUEsV0FBTztBQUFBLEVBQ1g7QUFBQSxFQUdBLHFCQUE2QjtBQUN6QixVQUFNLFNBQVMsS0FBSyxTQUFTO0FBQzdCLFVBQU0sRUFBRSxRQUFRLFVBQVUsTUFBTSxJQUFJLEtBQUs7QUFDekMsVUFBTSxtQkFBbUIsU0FBUyxHQUFHLEtBQUssSUFBSSxZQUFZLHFCQUFxQixRQUFRLEtBQUssVUFBVSxJQUFJLE1BQU07QUFDaEgsVUFBTSxzQkFBc0IsWUFBWSxTQUFTLFNBQVMsSUFBSSxTQUFTLElBQUksV0FBUyxLQUFLLEtBQUssSUFBSSxZQUFZLHFCQUFxQixPQUFPLEtBQUssVUFBVSxJQUFJLEdBQUcsRUFBRSxLQUFLLElBQUksSUFBSTtBQUMvSyxVQUFNLG1CQUFtQixTQUFTLE1BQU0sU0FBUyxJQUFJLE1BQU0sSUFBSSxVQUFRLEtBQUssS0FBSyxJQUFJLFlBQVkscUJBQXFCLE1BQU0sS0FBSyxVQUFVLElBQUksR0FBRyxFQUFFLEtBQUssSUFBSSxJQUFJO0FBQ2pLLFVBQU0sWUFBWTtBQUFBLEVBQ3hCLGNBQWMsaUJBQWlCO0FBQUE7QUFBQSxJQUU3QjtBQUFBO0FBQUEsRUFFRjtBQUFBO0FBQUEsRUFFQTtBQUFBLEVBQ0EsY0FBYztBQUFBO0FBR1IsV0FBTztBQUFBLEVBQ1g7QUFBQSxFQUVBLE1BQU0sa0JBQWtCLGFBQXFCLGVBQWUscUJBQW9DO0FBQzVGLFFBQUk7QUFDQSxZQUFNLE1BQU0sS0FBSyxtQkFBbUI7QUFFcEMsWUFBTSxjQUFjLEtBQUssSUFBSSxNQUFNLFFBQVEsS0FBSyxXQUFXLENBQUMsWUFBWTtBQUNwRSxjQUFNLGtCQUFrQixRQUFRLFNBQVMsSUFBSTtBQUM3QyxjQUFNLGNBQWMsa0JBQWtCLFVBQVUsR0FBRztBQUFBLEtBQWdCLEdBQUcsS0FBSyxPQUFPLFVBQVUsTUFBTztBQUNuRyxlQUFPO0FBQUEsTUFDWCxDQUFDLEVBQUUsTUFBTSxDQUFDLFFBQVE7QUFDZCxnQkFBUSxNQUFNLDhCQUE4QixHQUFHO0FBQUEsTUFDbkQsQ0FBQztBQUFBLElBQ0wsU0FBUyxPQUFQO0FBRUUsVUFBSSx1QkFBTyw4QkFBOEIsTUFBTSxtRUFBbUU7QUFBQSxJQUN0SDtBQUFBLEVBQ0o7QUFHSjs7O0FEdk9PLElBQU0sbUJBQU4sTUFBdUI7QUFBQSxFQUkxQixZQUFZLGdCQUEyQjtBQUNuQyxTQUFLLE1BQU0sZUFBZTtBQUMxQixTQUFLLFNBQVM7QUFBQSxFQUNsQjtBQUFBLEVBRUEsTUFBTSxnQkFBZ0Isa0JBQTBCLFNBQWlCLGNBQXNCLGVBQWtDLHlCQUE4RDtBQUVuTCxRQUFJLGVBQWUsMkJBQTJCLEtBQUssT0FBTyxTQUFTO0FBQ25FLFFBQUksY0FBYztBQUNkLFVBQUk7QUFDQSxjQUFNLGVBQWUsS0FBSyxJQUFJLE1BQU0sY0FBYyxZQUFZO0FBQzlELFlBQUksY0FBYztBQUNkLG9CQUFVLE1BQU0sS0FBSyxJQUFJLE1BQU0sS0FBSyxZQUFZO0FBQ2hELGtCQUFRLElBQUksT0FBTztBQUFBLFFBQ3ZCLE9BQU87QUFDSCxjQUFJLHdCQUFPLDRCQUE0QixjQUFjO0FBQUEsUUFDekQ7QUFBQSxNQUNKLFNBQVMsT0FBUDtBQUNFLFlBQUksd0JBQU8sZ0NBQWdDLE1BQU0sU0FBUztBQUFBLE1BQzlEO0FBQUEsSUFDSjtBQUVBLFFBQUk7QUFDQSxZQUFNLE9BQU8sTUFBTSxLQUFLLElBQUksTUFBTSxPQUFPLGtCQUFrQixPQUFPO0FBQ2xFLFVBQUksd0JBQU8scUJBQXFCLGtCQUFrQjtBQUNsRCxZQUFNLEtBQUssSUFBSSxZQUFZLG1CQUFtQixNQUFNLENBQUMsZ0JBQWdCO0FBQ2pFLG9CQUFZLFlBQVksSUFBSTtBQUFBLE1BQ2hDLENBQUM7QUFDRCxZQUFNLG1CQUFtQixJQUFJLGlCQUFpQixLQUFLLFFBQVEsSUFBSTtBQUMvRCx1QkFBaUIsUUFBUTtBQUN6QixZQUFNLGlCQUFpQixrQkFBa0I7QUFHekMsYUFBTztBQUFBLElBQ1gsU0FBUyxPQUFQO0FBQ0UsVUFBSSx3QkFBTyw0QkFBNEIsTUFBTSxTQUFTO0FBQ3REO0FBQUEsSUFDSjtBQUFBLEVBQ0o7QUFBQSxFQUVBLDJCQUEyQixRQUF5QjtBQUNoRCxhQUFTLFVBQVUsS0FBSyxJQUFJLE1BQU0sUUFBUTtBQUMxQyxRQUFJLGlCQUFpQixpQ0FBUSxLQUFLLFFBQVEsNEJBQTRCO0FBQ3RFLFFBQUksT0FBTyxPQUFPLEdBQUc7QUFDakIsdUJBQWlCLE9BQU8sTUFBTSxRQUFRO0FBQUEsSUFDMUM7QUFDQSxXQUFPLEdBQUcsT0FBTyxPQUFPLElBQUksS0FBSyxPQUFPLE9BQU8sTUFBTSxLQUFLLE9BQU8sU0FBUyxrQkFBa0IsS0FBSyxPQUFPLFNBQVMsc0JBQXNCLGVBQWUsS0FBSyxJQUFJLEtBQUssS0FBSyxPQUFPLFNBQVM7QUFBQSxFQUM3TDtBQUFBLEVBRUEsTUFBTSxpQkFBaUIsTUFBYSxhQUF3RDtBQUN4RixRQUFJLENBQUMsS0FBSyxZQUFZLElBQUksR0FBRztBQUN6QjtBQUFBLElBQ0o7QUFFQSxVQUFNLGFBQWEsTUFBTSxLQUFLLElBQUksTUFBTSxRQUFRLE9BQU8sS0FBSyxJQUFJO0FBQ2hFLFFBQUksQ0FBQyxZQUFZO0FBQ2I7QUFBQSxJQUNKO0FBRUEsVUFBTSxlQUFlLEtBQUssZ0JBQWdCLElBQUk7QUFDOUMsVUFBTSxjQUFjLEtBQUssMkJBQTJCLFlBQVk7QUFFaEUsUUFBSSxnQkFBZ0IsS0FBSyxNQUFNO0FBQzNCLFVBQUk7QUFDQSxZQUFJLGFBQWE7QUFDYixzQkFBWSxLQUFLLElBQUk7QUFBQSxRQUN6QjtBQUVBLGNBQU0sS0FBSyxJQUFJLFlBQVksV0FBVyxNQUFNLFdBQVc7QUFFdkQsY0FBTSxrQkFBa0IsWUFBWSxNQUFNLEdBQUcsRUFBRSxJQUFJLEtBQUs7QUFDeEQsWUFBSSxvQkFBb0IsSUFBSTtBQUN4QixjQUFJLHdCQUFPLDBCQUEwQixpQkFBaUI7QUFBQSxRQUMxRDtBQUFBLE1BQ0osU0FBUyxPQUFQO0FBQ0UsZ0JBQVEsTUFBTSw4QkFBOEIsS0FBSztBQUFBLE1BQ3JEO0FBQUEsSUFDSjtBQUFBLEVBQ0o7QUFBQSxFQUVBLE1BQU0saUJBQWlCLE1BQWE7QUFDaEMsV0FBTyxLQUFLLElBQUksY0FBYyxhQUFhLElBQUk7QUFBQSxFQUNuRDtBQUFBLEVBRUEsc0JBQXNCLGNBQXNCLGVBQTZCO0FBNUY3RTtBQTZGUSxVQUFNLFFBQVEsS0FBSyxJQUFJLE1BQU0saUJBQWlCO0FBQzlDLFVBQU0sZ0JBQXlCLENBQUM7QUFFaEMsZUFBVyxRQUFRLE9BQU87QUFDdEIsWUFBTSxXQUFXLEtBQUssSUFBSSxjQUFjLGFBQWEsSUFBSTtBQUN6RCxVQUFJLFlBQVksU0FBUyxhQUFhO0FBQ2xDLFlBQUksU0FBUyxZQUFZLFlBQVksTUFBTSxtQkFDdkMsY0FBUyxZQUFZLFlBQVksTUFBakMsbUJBQW9DLFNBQVMsaUJBQWdCO0FBQzdELHdCQUFjLEtBQUssSUFBSTtBQUFBLFFBQzNCO0FBQUEsTUFDSjtBQUFBLElBQ0o7QUFFQSxXQUFPO0FBQUEsRUFDWDtBQUFBLEVBRUEsTUFBTSxtQkFBbUIsU0FBa0IsYUFBd0Q7QUE3R3ZHO0FBOEdRLFFBQUksbUJBQW1CLDBCQUFTO0FBQzVCLFlBQU0sU0FBUztBQUNmLFlBQU0sYUFBYSxLQUFLLHdCQUF3QixPQUFPLElBQUk7QUFDM0QsVUFBSSxlQUFlLE9BQU8sTUFBTTtBQUM1QixjQUFNLFVBQVUsS0FBRyxZQUFPLFdBQVAsbUJBQWUsUUFBTyxPQUFPLE9BQU8sT0FBTyxNQUFNLEtBQUs7QUFHekUsWUFBSSxhQUFhO0FBQ2Isc0JBQVksT0FBTyxJQUFJO0FBQUEsUUFDM0I7QUFFQSxjQUFNLEtBQUssSUFBSSxZQUFZLFdBQVcsUUFBUSxPQUFPO0FBQ3JELFlBQUksd0JBQU8sc0JBQXNCLFlBQVk7QUFBQSxNQUNqRDtBQUFBLElBQ0o7QUFBQSxFQUNKO0FBQUEsRUFHQSxnQkFBZ0IsU0FBaUM7QUFDN0MsUUFBSSxTQUFTLFFBQVE7QUFDckIsUUFBSSxDQUFDLFFBQVE7QUFDVCxhQUFPLEtBQUssSUFBSSxNQUFNLFFBQVE7QUFBQSxJQUNsQyxPQUNLO0FBQ0QsYUFBTztBQUFBLElBQ1g7QUFBQSxFQUVKO0FBQUEsRUFFQSxZQUFZLFNBQWlDO0FBQ3pDLFFBQUksbUJBQW1CLHdCQUFPO0FBQzFCLFlBQU0sV0FBVyxLQUFLLElBQUksY0FBYyxhQUFhLE9BQU87QUFDNUQsWUFBTSxlQUFlLEtBQUssT0FBTyxTQUFTO0FBQzFDLFlBQU0sZ0JBQWdCLEtBQUssT0FBTyxTQUFTO0FBRTNDLFVBQUksWUFBWSxTQUFTLGFBQWE7QUFDbEMsZUFBTyxTQUFTLFlBQVksWUFBWSxNQUFNLGlCQUMxQyxPQUFPLEtBQUssU0FBUyxXQUFXLEVBQUUsU0FBUyxZQUFZO0FBQUEsTUFDL0Q7QUFBQSxJQUNKO0FBQ0EsV0FBTztBQUFBLEVBQ1g7QUFBQSxFQUdBLHdCQUF3QixZQUE0QjtBQUNoRCxVQUFNLFFBQVEsS0FBSyxPQUFPLFNBQVM7QUFDbkMsUUFBSSxXQUFXLFdBQVcsS0FBSyxHQUFHO0FBQzlCLGFBQU87QUFBQSxJQUNYO0FBQ0EsaUJBQWEsV0FBVyxRQUFRLDRCQUE0QixFQUFFO0FBRTlELFdBQU8sUUFBUSxHQUFHLFFBQVEsZUFBZTtBQUFBLEVBQzdDO0FBQUE7QUFBQTtBQUFBO0FBQUEsRUFLQSxrQkFBa0IsU0FBd0IsU0FBeUI7QUFDL0QsUUFBSSxtQkFBbUIsMEJBQVM7QUFDNUIsYUFBTztBQUFBLElBQ1g7QUFFQSxXQUFPLFFBQVEsVUFBVSxHQUFHLFFBQVEsWUFBWSxHQUFHLENBQUM7QUFBQSxFQUN4RDtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsRUFNQSxvQkFBb0IsZUFBd0IsU0FBMEI7QUFDbEUsVUFBTSxnQkFBZ0IsUUFBUSxVQUFVLEdBQUcsUUFBUSxZQUFZLEdBQUcsQ0FBQztBQUNuRSxVQUFNLGdCQUFnQixjQUFjLEtBQUssVUFBVSxHQUFHLGNBQWMsS0FBSyxZQUFZLEdBQUcsQ0FBQztBQUd6RixXQUFPLGtCQUFrQjtBQUFBLEVBQzdCO0FBQUE7QUFBQTtBQUFBO0FBQUEsRUFLQSxjQUFjLE1BQXNCO0FBQ2hDLFdBQU8sS0FBSyxRQUFRLGNBQWMsRUFBRTtBQUFBLEVBQ3hDO0FBQUE7QUFBQTtBQUFBO0FBQUEsRUFLQSxjQUFjLFdBQW1CLFVBQTJCO0FBQ3hELFVBQU0saUJBQWlCLEtBQUssY0FBYyxRQUFRO0FBQ2xELFVBQU0sa0JBQWtCLEtBQUssY0FBYyxTQUFTO0FBRXBELFdBQU8sb0JBQW9CLGtCQUFrQixnQkFBZ0IsV0FBVyxpQkFBaUIsR0FBRztBQUFBLEVBQ2hHO0FBRUo7OztBRzVNQSxJQUFBQyxtQkFBK0Q7QUFLL0QsSUFBcUIsbUJBQXJCLE1BQXNDO0FBQUEsRUFBdEM7QUFDSSwwQkFBaUI7QUFDakIsNEJBQW1CO0FBQ25CLHdCQUF3QjtBQUN4QiwwQkFBMkIsQ0FBQztBQUM1QixxQkFBb0I7QUFDcEIsK0JBQStCO0FBQy9CLDJCQUEwQjtBQUMxQiwyQkFBMEI7QUFDMUIsMkJBQTBCO0FBQUE7QUFDOUI7QUFFTyxJQUFNLGNBQU4sY0FBMEIsa0NBQWlCO0FBQUEsRUFHOUMsWUFBWSxLQUFVLFFBQW1CO0FBQ3JDLFVBQU0sS0FBSyxNQUFNO0FBQ2pCLFNBQUssU0FBUztBQUFBLEVBQ2xCO0FBQUEsRUFFQSxVQUFnQjtBQUNaLFVBQU0sRUFBRSxZQUFZLElBQUk7QUFFeEIsZ0JBQVksTUFBTTtBQUVsQixRQUFJLHlCQUFRLFdBQVcsRUFDbEIsUUFBUSxrQkFBa0IsRUFDMUIsUUFBUSx1REFBdUQsRUFDL0Q7QUFBQSxNQUFRLENBQUMsU0FDTixLQUNLLGVBQWUsa0JBQWtCLEVBQ2pDLFNBQVMsS0FBSyxPQUFPLFNBQVMsY0FBYyxFQUM1QyxTQUFTLE9BQU8sVUFBVTtBQUN2QixhQUFLLE9BQU8sU0FBUyxpQkFBaUI7QUFDdEMsY0FBTSxLQUFLLE9BQU8sYUFBYTtBQUFBLE1BQ25DLENBQUM7QUFBQSxJQUNUO0FBRUosUUFBSSx5QkFBUSxXQUFXLEVBQ2xCLFFBQVEsb0JBQW9CLEVBQzVCLFFBQVEsZ0dBQWdHLEVBQ3hHO0FBQUEsTUFBUSxDQUFDLFNBQ04sS0FDSyxlQUFlLG9CQUFvQixFQUNuQyxTQUFTLEtBQUssT0FBTyxTQUFTLGdCQUFnQixFQUM5QyxTQUFTLE9BQU8sVUFBVTtBQUN2QixhQUFLLE9BQU8sU0FBUyxtQkFBbUI7QUFDeEMsY0FBTSxLQUFLLE9BQU8sYUFBYTtBQUFBLE1BQ25DLENBQUM7QUFBQSxJQUNUO0FBRUosUUFBSSx5QkFBUSxXQUFXLEVBQ2xCLFFBQVEsZUFBZSxFQUN2QixRQUFRLCtDQUErQyxFQUN2RCxRQUFRLENBQUMsU0FBUztBQUNmLFdBQ0ssZUFBZSxlQUFlLEVBQzlCLFNBQVMsT0FBTyxVQUFVO0FBQ3ZCLGFBQUssT0FBTyxTQUFTLGVBQWU7QUFDcEMsY0FBTSxLQUFLLE9BQU8sYUFBYTtBQUFBLE1BQ25DLENBQUM7QUFDTCxVQUFJLEtBQUssT0FBTyxTQUFTLGNBQWM7QUFDbkMsYUFBSyxTQUFTLEtBQUssT0FBTyxTQUFTLFlBQVk7QUFBQSxNQUNuRDtBQUFBLElBQ0osQ0FBQztBQUNMLGdCQUFZLFVBQVUsRUFBRSxNQUFNLGdDQUFnQyxLQUFLLENBQUMsNEJBQTRCLGlCQUFpQixFQUFFLENBQUM7QUFFcEgsUUFBSSx5QkFBUSxXQUFXLEVBQ2xCLFFBQVEsaUJBQWlCLEVBQ3pCLFFBQVEsa0VBQWtFLEVBQUUsWUFBWSxDQUFDLGFBQWE7QUFDbkcsZUFDSyxlQUFlLGlCQUFpQixFQUNoQyxTQUFTLEtBQUssT0FBTyxTQUFTLGVBQWUsS0FBSyxJQUFJLENBQUMsRUFDdkQsU0FBUyxPQUFPLFVBQVU7QUFDdkIsYUFBSyxPQUFPLFNBQVMsaUJBQWlCLE1BQU0sTUFBTSxJQUFJLEVBQUUsSUFBSSxDQUFDLFNBQVMsS0FBSyxLQUFLLENBQUM7QUFDakYsY0FBTSxLQUFLLE9BQU8sYUFBYTtBQUFBLE1BQ25DLENBQUM7QUFBQSxJQUNULENBQUM7QUFHTCxRQUFJLHlCQUFRLFdBQVcsRUFDbEIsUUFBUSxtQkFBbUIsRUFDM0IsUUFBUSx5Q0FBeUMsRUFDakQ7QUFBQSxNQUFRLENBQUMsU0FDTixLQUNLLGVBQWUsbUJBQW1CLEVBQ2xDLFNBQVMsS0FBSyxPQUFPLFNBQVMsZUFBZSxFQUM3QyxTQUFTLE9BQU8sVUFBVTtBQUN2QixhQUFLLE9BQU8sU0FBUyxrQkFBa0I7QUFDdkMsY0FBTSxLQUFLLE9BQU8sYUFBYTtBQUFBLE1BQ25DLENBQUM7QUFBQSxJQUNUO0FBRUosUUFBSSx5QkFBUSxXQUFXLEVBQ2xCLFFBQVEsbUJBQW1CLEVBQzNCLFFBQVEseUNBQXlDLEVBQ2pEO0FBQUEsTUFBUSxDQUFDLFNBQ04sS0FDSyxlQUFlLG1CQUFtQixFQUNsQyxTQUFTLEtBQUssT0FBTyxTQUFTLGVBQWUsRUFDN0MsU0FBUyxPQUFPLFVBQVU7QUFDdkIsYUFBSyxPQUFPLFNBQVMsa0JBQWtCO0FBQ3ZDLGNBQU0sS0FBSyxPQUFPLGFBQWE7QUFBQSxNQUNuQyxDQUFDO0FBQUEsSUFDVDtBQUVKLFFBQUkseUJBQVEsV0FBVyxFQUNsQixRQUFRLG9CQUFvQixFQUM1QixRQUFRLDJFQUEyRSxFQUNuRjtBQUFBLE1BQVEsQ0FBQyxTQUNOLEtBQ0ssZUFBZSxhQUFhLEVBQzVCLFNBQVMsS0FBSyxPQUFPLFNBQVMsZUFBZSxFQUM3QyxTQUFTLE9BQU8sVUFBVTtBQUN2QixhQUFLLE9BQU8sU0FBUyxrQkFBa0I7QUFDdkMsY0FBTSxLQUFLLE9BQU8sYUFBYTtBQUFBLE1BQ25DLENBQUM7QUFBQSxJQUNUO0FBRUosUUFBSSx5QkFBUSxXQUFXLEVBQ2xCLFFBQVEsaURBQWlELEVBQ3pELFFBQVEsNEZBQTRGLEVBQ3BHO0FBQUEsTUFBVSxDQUFDLFdBQ1IsT0FDSyxTQUFTLEtBQUssT0FBTyxTQUFTLG1CQUFtQixFQUNqRCxTQUFTLE9BQU8sVUFBVTtBQUN2QixhQUFLLE9BQU8sU0FBUyxzQkFBc0I7QUFDM0MsY0FBTSxLQUFLLE9BQU8sYUFBYTtBQUFBLE1BQ25DLENBQUM7QUFBQSxJQUNUO0FBR0osUUFBSSx5QkFBUSxXQUFXLEVBQ2xCLFFBQVEsa0JBQWtCLEVBQzFCLFFBQVEsdUVBQXVFLEVBQy9FLFVBQVUsQ0FBQyxXQUNSLE9BQ0ssY0FBYyxRQUFRLEVBQ3RCLFFBQVEsWUFBWTtBQUVqQixZQUFNLFVBQVUsS0FBSyxJQUFJLE1BQU0sU0FBUyxFQUFFLEtBQUssVUFBUSxnQkFBZ0Isc0JBQUs7QUFDNUUsWUFBTSxXQUFXLElBQUksaUJBQWlCLEtBQUssUUFBUSxPQUFnQjtBQUNuRSxZQUFNLGFBQWEsS0FBSyxJQUFJLE1BQU0sY0FBYyxFQUFFLE9BQU8sVUFBUSxnQkFBZ0Isd0JBQU87QUFFeEYsaUJBQVcsVUFBVSxZQUFZO0FBQzdCLGNBQU0sS0FBSyxPQUFPLGlCQUFpQixtQkFBbUIsTUFBaUI7QUFBQSxNQUMzRTtBQUNBLGNBQVEsSUFBSSxVQUFVO0FBRXRCLGVBQVMsbUJBQW1CO0FBQUEsSUFDaEMsQ0FBQyxDQUFDO0FBQUEsRUFDbEI7QUFFSjs7O0FDOUpBLElBQUFDLG1CQUFxRTtBQU1yRSxJQUFxQixnQkFBckIsTUFBbUM7QUFBQSxFQWlCL0IsWUFBWSxRQUFtQjtBQWIvQixTQUFRLHlCQUFzQyxvQkFBSSxJQUFJO0FBS3REO0FBQUE7QUFBQTtBQUFBLFNBQVEsb0JBTUosRUFBRSxXQUFXLG9CQUFJLElBQUksRUFBRTtBQUd2QixTQUFLLE1BQU0sT0FBTztBQUNsQixTQUFLLFNBQVM7QUFDZCxTQUFLLG1CQUFtQixJQUFJLGlCQUFpQixNQUFNO0FBQUEsRUFDdkQ7QUFBQSxFQUVBLE1BQU0sb0JBQW9CO0FBRXRCLFVBQU0sa0NBQThCLDJCQUFTLE9BQU8sWUFBMkI7QUFDM0UsWUFBTSxtQkFBbUIsSUFBSSxpQkFBaUIsS0FBSyxRQUFRLE9BQWdCO0FBQzNFLHVCQUFpQixRQUFRO0FBQ3pCLFlBQU0saUJBQWlCLG1CQUFtQjtBQUUxQyxrQ0FBNEIsT0FBTztBQUFBLElBQ3ZDLEdBQUcsa0JBQWtCLHVCQUF1QixJQUFJO0FBRWhELFVBQU0sa0NBQThCLDJCQUFTLE9BQU8sWUFBMkI7QUFDM0UsWUFBTSxtQkFBbUIsSUFBSSxpQkFBaUIsS0FBSyxRQUFRLE9BQWdCO0FBQzNFLHVCQUFpQixRQUFRO0FBQ3pCLFlBQU0saUJBQWlCLG1CQUFtQjtBQUFBLElBQzlDLEdBQUcsa0JBQWtCLHVCQUF1QixJQUFJO0FBR2hELFVBQU0sZ0NBQTRCLDJCQUFTLE9BQU8sWUFBMkI7QUFDekUsWUFBTSxLQUFLLGlCQUFpQixpQkFBaUIsT0FBZ0I7QUFDN0QsZ0NBQTBCLE9BQU87QUFBQSxJQUNyQyxHQUFHLGtCQUFrQixvQkFBb0IsSUFBSTtBQUk3QyxRQUFJLGVBQWUsUUFBUSxRQUFRO0FBR25DLFNBQUssT0FBTyxjQUFjLEtBQUssSUFBSSxNQUFNLEdBQUcsVUFBVSxDQUFDLFlBQVk7QUFFL0QsVUFBSSxLQUFLLE9BQU8sU0FBUyxlQUFlLEtBQUssVUFBUSxRQUFRLEtBQUssU0FBUyxJQUFJLENBQUMsR0FBRztBQUMvRTtBQUFBLE1BQ0o7QUFFQSxVQUFJLG1CQUFtQiwwQkFBUztBQUM1QixjQUFNLGtCQUFrQixLQUFLLGlCQUFpQiwyQkFBMkIsT0FBTztBQUNoRixhQUFLLGlCQUFpQixnQkFBZ0IsaUJBQWlCLElBQUksS0FBSyxPQUFPLFNBQVMsZ0JBQWdCLEtBQUssT0FBTyxTQUFTLGtCQUFrQixLQUFLLE9BQU8sU0FBUyxZQUFZO0FBQUEsTUFDNUs7QUFBQSxJQUNKLENBQUMsQ0FBQztBQUVGLFNBQUssT0FBTyxjQUFjLEtBQUssSUFBSSxNQUFNLEdBQUcsVUFBVSxPQUFPLFNBQVMsWUFBWTtBQXBFMUY7QUFzRVksVUFBSSxLQUFLLE9BQU8sU0FBUyxlQUFlLEtBQUssVUFBUSxRQUFRLEtBQUssU0FBUyxJQUFJLENBQUMsR0FBRztBQUMvRTtBQUFBLE1BQ0o7QUFHQSxVQUFJLEtBQUssdUJBQXVCLElBQUksT0FBTyxHQUFHO0FBRTFDLFlBQUksbUJBQW1CLDBCQUFTO0FBRTVCLGdCQUFNLG9CQUFvQixRQUFRLFFBQVEsY0FBYyxFQUFFO0FBQzFELGdCQUFNLHNCQUFxQixVQUFLLGtCQUFrQixlQUF2QixtQkFBbUMsUUFBUSxjQUFjO0FBR3BGLGNBQUksc0JBQXNCLHNCQUN0QixLQUFLLGtCQUFrQixVQUFVLElBQUksT0FBTyxLQUM1QyxLQUFLLGtCQUFrQixVQUFVLElBQUksaUJBQWlCLEdBQUc7QUFDekQsaUJBQUssa0JBQWtCLHNCQUFzQixRQUFRO0FBQ3JELGlCQUFLLGtCQUFrQjtBQUFBLFVBQzNCO0FBQUEsUUFDSjtBQUdBLFlBQUksbUJBQW1CLDBCQUFTLEtBQUssaUJBQWlCLFlBQVksT0FBTyxHQUFHO0FBQ3hFLHlCQUFlLGFBQWEsS0FBSyxZQUFZO0FBQ3pDLGtCQUFNLEtBQUssaUJBQWlCLGlCQUFpQixTQUFrQixDQUFDQyxhQUFZO0FBQ3hFLG1CQUFLLHVCQUF1QixJQUFJQSxRQUFPO0FBQUEsWUFDM0MsQ0FBQztBQUFBLFVBQ0wsQ0FBQztBQUFBLFFBQ0w7QUFFQSxhQUFLLHVCQUF1QixPQUFPLE9BQU87QUFDMUM7QUFBQSxNQUNKO0FBR0EsWUFBTSxxQkFBcUIsS0FBSyx1QkFBdUIsU0FBUyxPQUFPO0FBRXZFLFVBQUksb0JBQW9CO0FBQ3BCLGFBQUssc0JBQXNCLFNBQVMsT0FBTztBQUFBLE1BQy9DLFdBQVcsS0FBSyw2QkFBNkIsU0FBUyxPQUFPLEdBQUc7QUFFNUQ7QUFBQSxNQUNKO0FBR0EsV0FBSyxrQkFBa0IsVUFBVSxJQUFJLE9BQU87QUFHNUMsVUFBSSxRQUFRLFNBQVMsU0FBUztBQUMxQixhQUFLLGtCQUFrQixVQUFVLElBQUksUUFBUSxJQUFJO0FBQUEsTUFDckQ7QUFFQSxXQUFLLGtCQUFrQjtBQUV2QixxQkFBZSxhQUFhLEtBQUssWUFBWTtBQUN6QyxvQ0FBNEIsT0FBTztBQUFBLE1BQ3ZDLENBQUM7QUFFRCxVQUFJO0FBRUEsWUFBSSxRQUFRLFNBQVMsUUFBUSxNQUFNLEdBQUcsRUFBRSxJQUFJLEdBQUc7QUFFM0MsY0FBSSxtQkFBbUIsMEJBQVMsS0FBSyxpQkFBaUIsWUFBWSxPQUFPLEdBQUc7QUFDeEUsMkJBQWUsYUFBYSxLQUFLLFlBQVk7QUFDekMsb0JBQU0sS0FBSyxpQkFBaUIsaUJBQWlCLFNBQWtCLENBQUNBLGFBQVk7QUFDeEUscUJBQUssdUJBQXVCLElBQUlBLFFBQU87QUFBQSxjQUMzQyxDQUFDO0FBQUEsWUFDTCxDQUFDO0FBQUEsVUFDTDtBQUFBLFFBQ0osT0FFSztBQUVELGNBQUksS0FBSyxPQUFPLFNBQVMsb0JBQW9CLE1BQU0sbUJBQW1CLDBCQUFTO0FBQzNFLDJCQUFlLGFBQWEsS0FBSyxZQUFZO0FBQ3pDLG9CQUFNLEtBQUssaUJBQWlCLG1CQUFtQixTQUFTLENBQUNBLGFBQVk7QUFDakUscUJBQUssdUJBQXVCLElBQUlBLFFBQU87QUFBQSxjQUMzQyxDQUFDO0FBR0Qsb0JBQU0sSUFBSSxRQUFRLGFBQVcsV0FBVyxTQUFTLGtCQUFrQixtQkFBbUIsQ0FBQztBQUd2RixvQkFBTSxnQkFBZ0IsS0FBSyxJQUFJLE1BQU0saUJBQWlCLEVBQUU7QUFBQSxnQkFBTyxVQUMzRCxLQUFLLEtBQUssV0FBVyxRQUFRLE9BQU8sR0FBRztBQUFBLGNBQzNDO0FBRUEsb0JBQU0sYUFBYSxjQUFjO0FBQUEsZ0JBQU8sVUFDcEMsS0FBSyxpQkFBaUIsWUFBWSxJQUFJO0FBQUEsY0FDMUM7QUFHQSx5QkFBVyxhQUFhLFlBQVk7QUFDaEMsc0JBQU0sS0FBSyxpQkFBaUIsaUJBQWlCLFdBQVcsQ0FBQ0EsYUFBWTtBQUNqRSx1QkFBSyx1QkFBdUIsSUFBSUEsUUFBTztBQUFBLGdCQUMzQyxDQUFDO0FBQUEsY0FDTDtBQUFBLFlBQ0osQ0FBQztBQUFBLFVBQ0wsV0FFUyxtQkFBbUIsMEJBQVMsS0FBSyxpQkFBaUIsWUFBWSxPQUFPLEdBQUc7QUFDN0UsMkJBQWUsYUFBYSxLQUFLLFlBQVk7QUFDekMsb0JBQU0sS0FBSyxpQkFBaUIsaUJBQWlCLFNBQWtCLENBQUNBLGFBQVk7QUFDeEUscUJBQUssdUJBQXVCLElBQUlBLFFBQU87QUFBQSxjQUMzQyxDQUFDO0FBQUEsWUFDTCxDQUFDO0FBQUEsVUFDTDtBQUFBLFFBQ0o7QUFBQSxNQUNKLFNBQVMsT0FBUDtBQUNFLGdCQUFRLE1BQU0sOEJBQThCLGNBQWMsUUFBUSxTQUFTLEtBQUs7QUFBQSxNQUNwRjtBQUFBLElBQ0osQ0FBQyxDQUFDO0FBRUYsU0FBSyxPQUFPLGNBQWMsS0FBSyxJQUFJLE1BQU0sR0FBRyxVQUFVLENBQUMsWUFBWTtBQUMvRCxVQUFJLEtBQUssT0FBTyxTQUFTLGVBQWUsS0FBSyxVQUFRLFFBQVEsS0FBSyxTQUFTLElBQUksQ0FBQyxHQUFHO0FBQy9FO0FBQUEsTUFDSjtBQUNBLGtDQUE0QixPQUFPO0FBQ25DLGtDQUE0QixPQUFPO0FBQUEsSUFDdkMsQ0FBQyxDQUFDO0FBRUYsU0FBSyxPQUFPLGNBQWMsS0FBSyxJQUFJLE1BQU0sR0FBRyxVQUFVLE9BQU8sWUFBWTtBQUVyRSxVQUFJLEtBQUssT0FBTyxTQUFTLGVBQWUsS0FBSyxVQUFRLFFBQVEsS0FBSyxTQUFTLElBQUksQ0FBQyxHQUFHO0FBQy9FO0FBQUEsTUFDSjtBQUNBLGtDQUE0QixPQUFPO0FBQUEsSUFFdkMsQ0FBQyxDQUFDO0FBQUEsRUFFTjtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsRUFPUSxzQkFBc0IsU0FBd0IsU0FBdUI7QUFFekUsUUFBSSxLQUFLLGtCQUFrQixZQUFZO0FBQ25DLG1CQUFhLEtBQUssa0JBQWtCLFVBQVU7QUFBQSxJQUNsRDtBQUVBLFNBQUssa0JBQWtCLGFBQWEsS0FBSyxpQkFBaUIsa0JBQWtCLFNBQVMsT0FBTztBQUM1RixTQUFLLGtCQUFrQixZQUFZLEtBQUssSUFBSTtBQUM1QyxTQUFLLGtCQUFrQixVQUFVLE1BQU07QUFHdkMsU0FBSyxrQkFBa0I7QUFBQSxFQUMzQjtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsRUFNUSxvQkFBMEI7QUFFOUIsUUFBSSxLQUFLLGtCQUFrQixZQUFZO0FBQ25DLG1CQUFhLEtBQUssa0JBQWtCLFVBQVU7QUFBQSxJQUNsRDtBQUdBLFNBQUssa0JBQWtCLGFBQWEsV0FBVyxNQUFNO0FBQ2pELFdBQUssbUJBQW1CO0FBQUEsSUFDNUIsR0FBRyxrQkFBa0IsZUFBZTtBQUFBLEVBQ3hDO0FBQUE7QUFBQTtBQUFBO0FBQUEsRUFLUSxxQkFBMkI7QUFDL0IsUUFBSSxLQUFLLGtCQUFrQixZQUFZO0FBQ25DLG1CQUFhLEtBQUssa0JBQWtCLFVBQVU7QUFBQSxJQUNsRDtBQUVBLFNBQUssa0JBQWtCLGFBQWE7QUFDcEMsU0FBSyxrQkFBa0Isc0JBQXNCO0FBQzdDLFNBQUssa0JBQWtCLFlBQVk7QUFDbkMsU0FBSyxrQkFBa0IsVUFBVSxNQUFNO0FBQ3ZDLFNBQUssa0JBQWtCLGFBQWE7QUFBQSxFQUN4QztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsRUFNUSx1QkFBdUIsU0FBd0IsU0FBMEI7QUFFN0UsUUFBSSxDQUFDLEtBQUssa0JBQWtCLGFBQWEsQ0FBQyxLQUFLLGtCQUFrQixZQUFZO0FBQ3pFLGFBQU87QUFBQSxJQUNYO0FBR0EsVUFBTSxlQUFlLEtBQUssa0JBQWtCLFVBQVUsSUFBSSxPQUFPO0FBQ2pFLFVBQU0sVUFBVSxLQUFLLG9CQUFvQixPQUFPO0FBR2hELFdBQU8sQ0FBQyxnQkFBZ0IsQ0FBQztBQUFBLEVBQzdCO0FBQUE7QUFBQTtBQUFBO0FBQUEsRUFLUSw2QkFBNkIsU0FBd0IsU0FBMEI7QUFFbkYsUUFBSSxDQUFDLEtBQUssa0JBQWtCLGFBQWEsQ0FBQyxLQUFLLGtCQUFrQixZQUFZO0FBQ3pFLGFBQU87QUFBQSxJQUNYO0FBR0EsV0FBTyxLQUFLLG9CQUFvQixPQUFPO0FBQUEsRUFDM0M7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLEVBU1Esb0JBQW9CLE1BQXVCO0FBQy9DLFFBQUksQ0FBQyxLQUFLLGtCQUFrQixZQUFZO0FBQ3BDLGFBQU87QUFBQSxJQUNYO0FBR0EsUUFBSSxLQUFLLGlCQUFpQixjQUFjLE1BQU0sS0FBSyxrQkFBa0IsVUFBVSxHQUFHO0FBQzlFLGFBQU87QUFBQSxJQUNYO0FBR0EsUUFBSSxLQUFLLGtCQUFrQixxQkFBcUI7QUFDNUMsVUFBSSxLQUFLLGlCQUFpQixjQUFjLE1BQU0sS0FBSyxrQkFBa0IsbUJBQW1CLEdBQUc7QUFDdkYsZUFBTztBQUFBLE1BQ1g7QUFBQSxJQUNKO0FBR0EsZUFBVyxpQkFBaUIsS0FBSyxrQkFBa0IsV0FBVztBQUMxRCxVQUFJLEtBQUssaUJBQWlCLGNBQWMsTUFBTSxhQUFhLEdBQUc7QUFDMUQsZUFBTztBQUFBLE1BQ1g7QUFBQSxJQUNKO0FBRUEsV0FBTztBQUFBLEVBQ1g7QUFDSjs7O0FMOVNBLElBQXFCLFlBQXJCLGNBQXVDLHdCQUFPO0FBQUEsRUFLMUMsTUFBTSxTQUFTO0FBQ1gsVUFBTSxLQUFLLGFBQWE7QUFFeEIsU0FBSyxtQkFBbUIsSUFBSSxpQkFBaUIsSUFBSTtBQUVqRCxTQUFLLGdCQUFnQixJQUFJLGNBQWMsSUFBSTtBQUMzQyxTQUFLLGNBQWMsa0JBQWtCO0FBR3JDLFNBQUssV0FBVztBQUFBLE1BQ1osSUFBSTtBQUFBLE1BQ0osTUFBTTtBQUFBLE1BQ04sVUFBVSxZQUFZO0FBQ2xCLGNBQU0sYUFBYSxLQUFLLElBQUksVUFBVSxjQUFjO0FBQ3BELFlBQUksWUFBWTtBQUNaLGdCQUFNLG1CQUFtQixJQUFJLGlCQUFpQixNQUFNLFVBQVU7QUFDOUQsZ0JBQU0saUJBQWlCLGVBQWU7QUFDdEMsY0FBSSx3QkFBTyx5QkFBeUIsV0FBVyxNQUFNO0FBQUEsUUFDekQ7QUFBQSxNQUNKO0FBQUEsSUFDSixDQUFDO0FBQUEsRUFpQkw7QUFBQSxFQUlBLFdBQVc7QUFBQSxFQUFFO0FBQUEsRUFFYixNQUFNLGVBQWU7QUFDakIsU0FBSyxXQUFXLE9BQU87QUFBQSxNQUNuQixDQUFDO0FBQUEsTUFDRCxJQUFJLGlCQUFpQjtBQUFBLE1BQ3JCLE1BQU0sS0FBSyxTQUFTO0FBQUEsSUFDeEI7QUFDQSxTQUFLLGNBQWMsSUFBSSxZQUFZLEtBQUssS0FBSyxJQUFJLENBQUM7QUFBQSxFQUN0RDtBQUFBLEVBRUEsTUFBTSxlQUFlO0FBQ2pCLFVBQU0sS0FBSyxTQUFTLEtBQUssUUFBUTtBQUFBLEVBQ3JDO0FBQ0o7IiwKICAibmFtZXMiOiBbImltcG9ydF9vYnNpZGlhbiIsICJpbXBvcnRfb2JzaWRpYW4iLCAiaW1wb3J0X29ic2lkaWFuIiwgImltcG9ydF9vYnNpZGlhbiIsICJvbGRQYXRoIl0KfQo=
